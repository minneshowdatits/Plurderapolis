<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PLURderapolis — Harm Reduction for Minnesota Ravers</title>
<meta name="description" content="Harm reduction tools, scene alerts, and Minnesota resources for ravers.">
<meta name="theme-color" content="#0a0a0a">

<style>
/* -------------------- Base / Theme -------------------- */
:root{
  --bg:#0a0a0a;                 /* deep black */
  --panel:#1a1024;              /* inky violet */
  --panel-2:#311a4f;            /* deeper card bg */
  --text:#ffffff;
  --muted:#c9c9c9;
  --line:#30303a;

  /* neon gradient from your logo */
  --grad: linear-gradient(135deg,#24d6ff 0%, #7ae1ff 18%, #ff49c2 45%, #a84bff 70%, #3aa7ff 100%);
  --accent:#24d6ff;             /* cyan */
  --accent-2:#ff49c2;           /* magenta */
  --accent-3:#a84bff;           /* purple */
  --danger:#ff3b6b;             /* alert pink/red */
  --warn:#ffb84d;               /* amber */
  --safe:#2ee07a;               /* green */
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--text);
  background:var(--bg);
  font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
}

/* -------------------- Skip link -------------------- */
.skip-link{
  position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;
}
.skip-link:focus{left:12px; top:12px; width:auto; height:auto; background:#000; color:#fff; padding:.5rem .75rem; border-radius:.5rem; z-index:10000}

/* -------------------- Header / Title -------------------- */
.header{
  max-width:1100px; margin:0 auto; padding:24px 16px 8px;
  text-align:center;
}
.brand{
  margin:0;
  font-weight:800;
  letter-spacing:.12em;
  text-transform:uppercase;
  font-size:clamp(28px,6vw,44px);
  background:var(--grad);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  filter:drop-shadow(0 0 8px rgba(36,214,255,.35));
}
.tagline{
  margin:.25rem 0 0;
  color:#a6f6ff;
  letter-spacing:.08em;
  text-transform:uppercase;
  font-weight:700;
  font-size:.95rem;
  opacity:.9;
}

/* -------------------- Nav -------------------- */
.nav-wrap{
  position:sticky; top:0; z-index:999;
  backdrop-filter:saturate(140%) blur(8px);
  background:linear-gradient(180deg, rgba(10,10,10,.9), rgba(10,10,10,.7));
  border-bottom:1px solid #1f1f26;
}
.nav{
  max-width:1100px; margin:auto; padding:10px 12px; display:flex; gap:8px; align-items:center;
}
.menu-btn{
  display:none;
  background:none; border:none; color:#fff; font-size:28px; line-height:1; cursor:pointer;
}
.nav ul{
  list-style:none; margin:0; padding:0;
  display:flex; flex-wrap:wrap; gap:8px;
}
.nav a{
  display:block; text-decoration:none; color:#fff; font-weight:700;
  padding:8px 12px; border-radius:8px;
  background:#3b2360;
  box-shadow:0 0 6px rgba(255,73,194,.22);
  transition:transform .15s ease, background .15s ease;
}
.nav a:hover{ transform:translateY(-1px); background:#4c2b80 }
.nav .spacer{ flex:1 }
.search{
  position:relative; width:min(360px,48vw);
}
#q{
  width:100%; padding:10px 12px 10px 38px; border-radius:999px;
  background:#0f0f16; border:1px solid #2b2b38; color:#fff;
  outline:2px solid transparent;
}
#q:focus{ outline:2px solid #24d6ff; }
.search .icon{
  position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.8;
}
.suggest{
  position:absolute; top:44px; left:0; right:0; background:#0f0f16; border:1px solid #2b2b38; border-radius:12px;
  display:none; max-height:260px; overflow:auto; z-index:10;
}
.suggest a{ display:block; padding:10px 12px; color:#fff; text-decoration:none; }
.suggest a:hover{ background:#1b1b29 }

/* Mobile menu */
@media (max-width:780px){
  .menu-btn{ display:block }
  .nav ul{ display:none }
  .nav ul.open{ display:flex; flex-direction:column; width:100% }
  .search{ width:100% }
}

/* -------------------- Ticker -------------------- */
.ticker{
  border-top:1px solid #272733; border-bottom:1px solid #272733;
  height:40px; display:flex; align-items:center; overflow:hidden;
  background:#101018;
}
.ticker a{
  color:var(--danger); text-decoration:none; white-space:nowrap; font-weight:700; padding-left:100%;
  animation:scroll 22s linear infinite;
}
@keyframes scroll{ from{ transform:translateX(0) } to{ transform:translateX(-100%) } }

/* -------------------- Sections -------------------- */
.section{
  max-width:1100px; margin:20px auto; padding:18px; border-radius:14px; background:var(--panel);
  box-shadow:0 0 12px rgba(36,214,255,.06);
}
.h2{
  margin:0 0 .75rem; font-size:1.25rem; letter-spacing:.06em; text-transform:uppercase; font-weight:800;
  background:var(--grad); -webkit-background-clip:text; background-clip:text; color:transparent;
}
p,li{ color:#e9e9e9 }

/* Buttons */
.btn{
  display:inline-block; text-decoration:none; color:#101018; font-weight:900;
  padding:.65rem 1rem; border-radius:12px; background:var(--grad);
  box-shadow:0 8px 20px rgba(168,75,255,.25);
}
.btn.ghost{
  background:#0f0f16; color:#fff; border:1px solid #2b2b38;
}

/* Cards / grid */
.grid{ display:grid; gap:12px }
@media(min-width:680px){ .grid.cols-2{ grid-template-columns:1fr 1fr } .grid.cols-3{ grid-template-columns:repeat(3,1fr)} .grid.cols-4{ grid-template-columns:repeat(4,1fr)} }
.card{
  background:var(--panel-2); border:1px solid #3a2b56; border-radius:12px; padding:14px;
}
.badge{ display:inline-block; padding:.1rem .5rem; border-radius:999px; font-size:.75rem; font-weight:800 }
.badge.red{ background:#3a0013; color:#ff6989 }
.badge.yellow{ background:#392400; color:#ffcf6a }
.badge.purple{ background:#23003d; color:#c47bff }

/* Collapsible */
.details{
  background:#120c1e; border:1px solid #2b1c43; border-radius:12px; padding:6px 10px;
}
.details summary{
  list-style:none; cursor:pointer; font-weight:800; color:#ff7dbd;
}
.details summary::-webkit-details-marker{ display:none }
.details[open]{ box-shadow:0 0 0 1px #43246f inset }

/* Panic peach */
.panic-fab{
  position:fixed; right:16px; bottom:80px; z-index:9999;
  width:64px; height:64px; border-radius:50%; display:grid; place-items:center;
  background:rgba(255,73,194,.2);
  box-shadow:0 0 14px #E040FB, 0 0 26px #FF69B4, 0 0 38px #24d6ff;
  font-size:34px; text-decoration:none; color:#fff;
  animation:pop 2.4s infinite;
}
@keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}

/* Mobile sticky emergency strip */
.sticky-strip{
  position:fixed; left:0; right:0; bottom:0; z-index:9998;
  display:flex; gap:8px; padding:8px; background:rgba(10,10,14,.9); backdrop-filter:blur(6px); border-top:1px solid #242436;
}
.strip-btn{
  flex:1; text-align:center; padding:.6rem .5rem; border-radius:12px; text-decoration:none; color:#000; font-weight:900;
}
.strip-911{ background:linear-gradient(135deg,#ff4d6f,#ff875a) }
.strip-narcan{ background:linear-gradient(135deg,#21e1ff,#2ee07a) }
.strip-panic{ background:linear-gradient(135deg,#a84bff,#ff49c2) }
@media(min-width:860px){ .sticky-strip{ display:none } }

/* Footer */
footer{ max-width:1100px; margin:40px auto; padding:0 16px 40px; color:var(--muted); }
footer hr{ border:0; height:1px; background:#242436; margin:24px 0 }
footer a{ color:#9fe8ff }
.small{ font-size:.85rem }
.last-updated{ opacity:.75 }

/* Focus ring */
a,button,[role="button"],input,select,summary{ outline-offset:2px }
a:focus,button:focus,input:focus,select:focus,summary:focus{ outline:2px solid var(--accent) }
</style>
</head>

<body>
<a class="skip-link" href="#main">Skip to content</a>

<header class="header" role="banner">
  <h1 class="brand">PLURderapolis</h1>
  <p class="tagline">Harm Reduction for Minnesota Ravers</p>
</header>

<div class="nav-wrap" role="navigation" aria-label="Primary">
  <div class="nav">
    <button class="menu-btn" aria-expanded="false" aria-controls="menu">☰</button>

    <ul id="menu" aria-label="Main menu">
      <li><a href="index.html">Home</a></li>

      <li><a href="panic.html">Panic</a></li>
      <li><a href="emergency.html">Emergency</a></li>
      <li><a href="spiking.html">Spiking</a></li>
      <li><a href="fake.html">Fake Pills</a></li>

      <li><a href="polydrug.html">Interaction Checker</a></li>
      <li><a href="rx-combos.html">RX + Party</a></li>
      <li><a href="health.html">Health</a></li>

      <li><a href="consent.html">Consent</a></li>
      <li><a href="accountability.html">Accountability</a></li>

      <li><a href="sober.html">Sober</a></li>
      <li><a href="mn-resources.html">MN Resources</a></li>
      <li><a href="resources.html">More Resources</a></li>
      <li><a href="spotify.html">Spotify</a></li>
    </ul>

    <div class="spacer"></div>

    <!-- Search -->
    <div class="search" role="search">
      <svg class="icon" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#9ea3ff" d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.48-4.23 6.5 6.5 0 1 0-6.5 6.5 6.471 6.471 0 0 0 4.23-1.48l.27.28v.79l4.25 4.25 1.5-1.5L15.5 14zm-6 0A4.5 4.5 0 1 1 14 9.5 4.505 4.505 0 0 1 9.5 14z"/></svg>
      <input id="q" type="search" placeholder="Search pages, tools, topics…" autocomplete="off" aria-label="Search site">
      <div id="suggestions" class="suggest" role="listbox" aria-label="Search suggestions"></div>
    </div>
  </div>
</div>

<!-- Ticker -->
<div class="ticker" aria-live="polite">
  <a href="scene/index.html" title="View all alerts">
    🚨 MN Drug Supply Alert: test your stuff • Carry Narcan • No solo dosing • Hydrate • Click for details
  </a>
</div>

<main id="main">
  <!-- What we do -->
  <section class="section">
    <h2 class="h2">💡 What We Do</h2>
    <p><strong>Peer-led harm reduction for the Minnesota rave & EDM scene.</strong> Quick tools, crisis info, consent culture, and local resources — judgment free.</p>
    <div class="grid cols-3">
      <div class="card">
        <p><span class="badge red">Emergency</span></p>
        <h3>Overdose & Panic</h3>
        <p>Step-by-step: recognize, respond, recover. Includes quick grounding for anxiety.</p>
        <p><a class="btn" href="panic.html">Open Panic</a> <a class="btn ghost" href="emergency.html">Emergency Guide</a></p>
      </div>
      <div class="card">
        <p><span class="badge yellow">Safer Use</span></p>
        <h3>Fake & Spiking</h3>
        <p>How to spot fakes, use test strips, and prevent drink spiking. Stay with friends & trust your gut.</p>
        <p><a class="btn" href="fake.html">Fake Pills</a> <a class="btn ghost" href="spiking.html">Spiking Guide</a></p>
      </div>
      <div class="card">
        <p><span class="badge purple">Culture</span></p>
        <h3>Consent & Accountability</h3>
        <p>Tools to build safer dance floors — and what to do when boundaries are crossed.</p>
        <p><a class="btn" href="consent.html">Consent Basics</a> <a class="btn ghost" href="accountability.html">Accountability</a></p>
      </div>
    </div>
  </section>

  <!-- Scene Alerts Preview -->
  <section class="section">
    <h2 class="h2">⚠️ Latest Scene Alerts</h2>
    <div class="grid cols-3">
      <div class="card">
        <p><span class="badge red">Critical</span></p>
        <h3>Fentanyl in Stimulants</h3>
        <p>OD cluster near NE house shows. Test lines & never rail alone.</p>
        <p><a class="btn" href="scene/index.html">View Details</a></p>
      </div>
      <div class="card">
        <p><span class="badge yellow">Caution</span></p>
        <h3>Drink Spiking Reports</h3>
        <p>Use closed-lid bottles, watch pours, and rotate friends as “safety lead.”</p>
        <p><a class="btn" href="spiking.html">Protection Tips</a></p>
      </div>
      <div class="card">
        <p><span class="badge purple">Info</span></p>
        <h3>Pressed “Molly” Pills</h3>
        <p>Some pink tablets tested 3-MMC + caffeine. Don’t trust color. Test it.</p>
        <p><a class="btn" href="fake.html">Fake Pill Guide</a></p>
      </div>
    </div>
  </section>

  <!-- Polydrug widget -->
  <section class="section" aria-labelledby="mix-head">
    <h2 id="mix-head" class="h2">💊 Quick Interaction Check</h2>
    <p>Choose two substances to see a summary. For deeper notes, open the full checker.</p>
    <div class="grid cols-3">
      <div class="card" style="grid-column:span 2">
        <form id="mix-form">
          <div class="grid cols-3">
            <label>
              <span class="small">Drug A</span>
              <select id="a" required></select>
            </label>
            <label>
              <span class="small">Drug B</span>
              <select id="b" required></select>
            </label>
            <div style="display:flex; align-items:flex-end;">
              <button class="btn" type="submit">Check</button>
            </div>
          </div>
        </form>
        <div id="mix-result" class="details" style="margin-top:12px;">
          <summary>Result</summary>
          <div id="mix-body" style="padding:8px 2px 6px 2px; color:#e9e9e9">Pick two items and tap <strong>Check</strong>.</div>
        </div>
      </div>
      <div class="card">
        <h3>Open Full Tool</h3>
        <p>More substances, notes, and safer-use strategies.</p>
        <p><a class="btn" href="polydrug.html">Full Interaction Checker</a></p>
      </div>
    </div>
    <p class="small" style="opacity:.8">Heads up: interactions vary by dose, tolerance, hydration, and health. When in doubt, skip the mix.</p>
  </section>

  <!-- Quick Tools -->
  <section class="section">
    <h2 class="h2">🧰 Quick Tools</h2>
    <div class="grid cols-4">
      <a class="card" href="panic.html"><h3>🍑 Panic Button</h3><p>Grounding + what to do right now.</p></a>
      <a class="card" href="badtrip.html"><h3>🌌 Bad Trip Mode</h3><p>Ride it out safely. Calming steps.</p></a>
      <a class="card" href="health.html"><h3>🧠 Health & Hydration</h3><p>Cool-down, fluids, electrolytes.</p></a>
      <a class="card" href="sober.html"><h3>🌱 Sober Options</h3><p>Fun without substances.</p></a>
    </div>
  </section>

  <!-- Consent / Accountability -->
  <section class="section">
    <h2 class="h2">🤝 Consent & Accountability</h2>
    <div class="grid cols-2">
      <a class="card" href="consent.html"><h3>Consent Basics</h3><p>Clear yes, ongoing, enthusiastic, reversible.</p></a>
      <a class="card" href="accountability.html"><h3>What if it’s violated?</h3><p>Report, support, and community repair options.</p></a>
    </div>
    <details class="details" style="margin-top:12px">
      <summary>🖤 Rejection-Based Violence is real — open for support</summary>
      <div style="padding:8px 2px 0">
        Saying “no” doesn’t make you cruel. Ignoring “no” is control. Learn how to document, get support, and keep friends safe.
        <p><a class="btn" href="rejection_based_violence.html">Learn More</a></p>
      </div>
    </details>
  </section>

  <!-- MN Resources -->
  <section class="section">
    <h2 class="h2">📍 Minnesota Resources</h2>
    <div class="grid cols-3">
      <a class="card" href="mn-resources.html"><h3>💉 Narcan & Test Strips</h3><p>Where to get free or low-cost supplies near you.</p></a>
      <a class="card" href="resources.html"><h3>📞 Crisis & Support</h3><p>24/7 hotlines, shelters, queer-affirming care.</p></a>
      <a class="card" href="resources.html#orgs"><h3>🏥 Local Harm Reduction Orgs</h3><p>Get help or get involved.</p></a>
    </div>
  </section>

  <!-- How to use -->
  <section class="section">
    <h2 class="h2">📖 How to Use This Website</h2>
    <ol>
      <li>Check <strong>Scene Alerts</strong> before you go out.</li>
      <li>Use the <strong>Interaction Checker</strong> if you’re mixing.</li>
      <li>Hit the <strong>🍑 Panic Button</strong> if overwhelmed.</li>
      <li>Review <strong>Consent</strong> and <strong>Accountability</strong> basics.</li>
      <li>Find <strong>MN Resources</strong> for Narcan, test strips, and support.</li>
      <li>Follow us on Instagram for updates.</li>
    </ol>
  </section>

  <!-- Contact / Social -->
  <section class="section">
    <h2 class="h2">📣 Stay Connected</h2>
    <p>Instagram: <a href="https://instagram.com/plurderapolis" target="_blank" rel="noopener">@plurderapolis</a></p>
    <p>Email: <a href="mailto:projectpeachmn@gmail.com">projectpeachmn@gmail.com</a></p>
  </section>
</main>

<!-- Panic floating button -->
<a class="panic-fab" href="panic.html" aria-label="Open Panic Button">🍑</a>

<!-- Mobile emergency strip -->
<nav class="sticky-strip" aria-label="Emergency quick actions">
  <a class="strip-btn strip-911" href="tel:911">🚨 911</a>
  <a class="strip-btn strip-narcan" href="mn-resources.html#narcan">💊 Narcan Info</a>
  <a class="strip-btn strip-panic" href="panic.html">🌀 Panic</a>
</nav>

<footer role="contentinfo">
  <hr>
  <p class="small">
    <strong>Disclaimer:</strong> PLURderapolis is a community harm reduction initiative. We are not medical professionals. The information on this site is for education only and is not medical advice. Always test substances, use with care, and call <strong>911</strong> in a medical emergency.
  </p>
  <p class="last-updated small">Last updated: <span id="lastUpdated"></span></p>
</footer>

<script>
/* ------------ Mobile menu toggle ------------ */
const menuBtn = document.querySelector('.menu-btn');
const menu = document.getElementById('menu');
menuBtn.addEventListener('click', () => {
  const open = menu.classList.toggle('open');
  menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
});

/* ------------ Search (tiny, local, offline) ------------ */
/* Index of your pages (title, url, tags). Add/remove as your repo changes */
const INDEX = [
  {t:"Panic Button", u:"panic.html", k:"panic anxiety grounding overdose help"},
  {t:"Emergency Response", u:"emergency.html", k:"overdose 911 rescue breathing naloxone"},
  {t:"Drink Spiking", u:"spiking.html", k:"gHB benzos drinks safety"},
  {t:"Fake Drug Guide", u:"fake.html", k:"fentanyl test strips pressed pills fake molly"},
  {t:"Polydrug Interaction Checker", u:"polydrug.html", k:"mixing combos interactions"},
  {t:"RX + Party Drug Combos", u:"rx-combos.html", k:"ssri snri maoi adhd antidepressant interactions"},
  {t:"Raver Health", u:"health.html", k:"hydration hyperthermia electrolytes sleep nutrition"},
  {t:"Consent Basics", u:"consent.html", k:"yes boundaries touch dance floor"},
  {t:"Accountability", u:"accountability.html", k:"report support safety plan"},
  {t:"Rejection-Based Violence", u:"rejection_based_violence.html", k:"stalking harassment safety"},
  {t:"Sober Options", u:"sober.html", k:"sober nightlife ideas fun"},
  {t:"MN Resources", u:"mn-resources.html", k:"narcan test strips clinic hotline"},
  {t:"All Resources", u:"resources.html", k:"support help hotlines shelters"},
  {t:"Spotify", u:"spotify.html", k:"music playlist"},
  {t:"Scene Alerts", u:"scene/index.html", k:"alerts warnings supply"}
];

const q = document.getElementById('q');
const sug = document.getElementById('suggestions');

function filterIndex(query){
  query = query.trim().toLowerCase();
  if(!query) return [];
  // very tiny fuzzy-ish match
  return INDEX
    .map(item=>{
      const str = (item.t + " " + item.k).toLowerCase();
      let score = 0;
      query.split(/\s+/).forEach(word=>{
        if(str.includes(word)) score += 1;
      });
      return {item, score};
    })
    .filter(o=>o.score>0)
    .sort((a,b)=>b.score-a.score)
    .slice(0,6)
    .map(o=>o.item);
}

function renderSuggestions(list){
  sug.innerHTML = "";
  if(!list.length){ sug.style.display="none"; return; }
  list.forEach(r=>{
    const a = document.createElement('a');
    a.href = r.u; a.role="option"; a.textContent = r.t;
    sug.appendChild(a);
  });
  sug.style.display = 'block';
}

q.addEventListener('input', ()=> renderSuggestions(filterIndex(q.value)));
q.addEventListener('focus', ()=> renderSuggestions(filterIndex(q.value)));
document.addEventListener('click', (e)=>{ if(!sug.contains(e.target) && e.target!==q) sug.style.display="none"; });
q.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && sug.firstChild){ window.location = sug.firstChild.getAttribute('href'); }});

/* ------------ Polydrug mini widget ------------ */
/* Minimal matrix; expand as needed. Keys must match OPTIONS below. */
const INTERACTIONS = {
  "Alcohol|MDMA": {risk:"caution", msg:"Dehydration & overheating risk. Sip water/electrolytes, cool down often. Avoid heavy drinking."},
  "Alcohol|Cocaine": {risk:"caution", msg:"Cocaethylene forms in the liver → added strain on heart & liver. Avoid or keep doses low and spaced."},
  "Alcohol|Benzos": {risk:"danger", msg:"Respiratory depression & blackouts. Do not combine."},
  "MDMA|SSRI": {risk:"reduced", msg:"SSRIs blunt MDMA effects; still risk for overheating. Wait weeks after SSRI changes before rolling."},
  "MDMA|MAOI": {risk:"danger", msg:"Serotonin syndrome risk. Absolutely avoid."},
  "MDMA|Cocaine": {risk:"danger", msg:"Cardio strain & overheating. Very risky mix."},
  "MDMA|Cannabis": {risk:"caution", msg:"Can intensify headspace and anxiety. Start low, hydrate, cool space."},
  "Cocaine|Opiates": {risk:"danger", msg:"Speedball: high overdose risk and masking effects. Avoid."},
  "Benzos|Opiates": {risk:"danger", msg:"Major respiratory depression risk. Do not mix."},
  "Ketamine|Alcohol": {risk:"caution", msg:"Additive sedation & nausea. Space out or avoid."},
  "Ketamine|Benzos": {risk:"caution", msg:"Heavy sedation and memory issues. Avoid driving/standing; sit with friends."},
  "Cannabis|Alcohol": {risk:"caution", msg:"Increases dizziness & nausea. Go slow."}
};
const OPTIONS = [
  "Alcohol","MDMA","Cocaine","Cannabis","Ketamine","Benzos","Opiates","SSRI","MAOI"
];
const selA = document.getElementById('a');
const selB = document.getElementById('b');
OPTIONS.forEach(v=>{
  const o1 = document.createElement('option'); o1.value=v; o1.textContent=v; selA.appendChild(o1);
  const o2 = document.createElement('option'); o2.value=v; o2.textContent=v; selB.appendChild(o2);
});
document.getElementById('mix-form').addEventListener('submit', e=>{
  e.preventDefault();
  const a = selA.value, b = selB.value;
  if(a===b){ showMix("caution","Same substances: effects stack. Dose lower and space out."); return; }
  const key = [a,b].sort().join("|");
  const data = INTERACTIONS[key];
  if(!data){ showMix("info","No specific data in the quick index. Open the full checker for details."); return; }
  showMix(data.risk, data.msg);
});
function showMix(level, text){
  const out = document.getElementById('mix-body');
  let label = "Info"; let color = "#9fe8ff";
  if(level==="danger"){ label="Danger"; color= "#ff6989"; }
  else if(level==="caution"){ label="Caution"; color= "#ffcf6a"; }
  else if(level==="reduced"){ label="Reduced effect"; color="#9fe8ff"; }
  out.innerHTML = `<strong style="color:${color}">${label}:</strong> ${text}`;
}

/* ------------ Last updated ------------ */
document.getElementById('lastUpdated').textContent = new Date(document.lastModified).toLocaleString();

/* ------------ Offline cache (service worker via Blob) ------------ */
if('serviceWorker' in navigator){
  const swCode = `
    const CACHE='plur-v1';
    const PRECACHE = [
      '/', '/index.html',
      '/panic.html','/emergency.html','/spiking.html','/fake.html',
      '/polydrug.html','/rx-combos.html','/health.html',
      '/consent.html','/accountability.html','/rejection_based_violence.html',
      '/sober.html','/mn-resources.html','/resources.html','/spotify.html',
      '/scene/index.html'
    ];
    self.addEventListener('install', e=>{
      e.waitUntil(caches.open(CACHE).then(c=>c.addAll(PRECACHE)).then(()=>self.skipWaiting()));
    });
    self.addEventListener('activate', e=>{
      e.waitUntil(self.clients.claim());
    });
    self.addEventListener('fetch', e=>{
      const req = e.request;
      e.respondWith(
        caches.match(req).then(cached => cached || fetch(req).then(r=>{
          const copy = r.clone();
          caches.open(CACHE).then(c=>c.put(req, copy));
          return r;
        }).catch(()=> caches.match('/index.html')))
      );
    });
  `;
  const blob = new Blob([swCode], {type:'text/javascript'});
  const swURL = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swURL);
}
</script>
</body>
</html>
