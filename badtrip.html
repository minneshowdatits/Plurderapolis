<!DOCTYPE html>
<html lang="en">
<head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3R9P09YYJC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3R9P09YYJC');
</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PLURderapolis ‚Äî Bad Trip Guide</title>
<meta name="description" content="A safe space for grounding during difficult psychedelic experiences">
<meta name="theme-color" content="#1c0028">
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* Base theme */
  :root{
    --bg:#1c0028;
    --card:#2a0040;
    --accent:#ff6ec7;
    --mint:#00f7e0;
    --text:#eee;
    --soft-purple:#3a0055;
    --light-purple:#4a0066;
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --shadow: 0 4px 20px rgba(0,0,0,0.3);
    --section-spacing: 1.5rem;
  }
  
  /* Reset and base styles */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px;
  }
  
  body {
    font-family: 'Roboto', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
    background: radial-gradient(ellipse at top, #2a0040 0%, #1c0028 100%);
    padding-top: 60px; /* Space for fixed header */
  }
  
  /* Header */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(28, 0, 40, 0.95);
    backdrop-filter: blur(10px);
    z-index: 1000;
    padding: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .header-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
  
  .main-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.4rem;
    color: var(--mint);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
  }
  
  .main-title:hover {
    color: #fff;
  }
  
  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    background: var(--accent);
    color: #111;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    transition: var(--transition-bounce);
  }
  
  .menu-toggle:hover {
    transform: scale(1.1);
  }
  
  /* Navigation */
  .nav-links {
    display: flex;
    gap: 1rem;
    list-style: none;
  }
  
  .nav-link {
    color: var(--text);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    transition: var(--transition-smooth);
    font-weight: 500;
    white-space: nowrap;
  }
  
  .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--mint);
  }
  
  /* Main container */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
  }
  
  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 100px;
    height: calc(100vh - 120px);
    overflow-y: auto;
    padding: 1.5rem;
    background: var(--card);
    border-radius: 12px;
    box-shadow: var(--shadow);
  }
  
  .sidebar::-webkit-scrollbar {
    width: 4px;
  }
  
  .sidebar::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .sidebar::-webkit-scrollbar-thumb {
    background: var(--mint);
    border-radius: 2px;
  }
  
  .section-nav {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .section-btn {
    background: transparent;
    color: var(--text);
    border: none;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Roboto', sans-serif;
    font-size: 0.95rem;
    position: relative;
  }
  
  .section-btn:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(5px);
    color: var(--mint);
  }
  
  .section-btn.active {
    background: rgba(0, 247, 224, 0.1);
    color: var(--mint);
    border-left: 3px solid var(--mint);
    padding-left: calc(1rem - 3px);
  }
  
  .section-btn i {
    width: 20px;
    text-align: center;
    font-size: 1.1rem;
  }
  
  /* Main content */
  .main-content {
    min-height: 100vh;
  }
  
  .section {
    background: var(--card);
    border-radius: 12px;
    margin-bottom: var(--section-spacing);
    overflow: hidden;
    box-shadow: var(--shadow);
    opacity: 0;
    transform: translateY(20px);
    animation: sectionFadeIn 0.5s ease-out forwards;
  }
  
  @keyframes sectionFadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Section header (collapsible) */
  .section-header {
    padding: 1.25rem 1.5rem;
    background: linear-gradient(135deg, var(--soft-purple), var(--card));
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: var(--transition-smooth);
  }
  
  .section-header:hover {
    background: linear-gradient(135deg, var(--light-purple), var(--soft-purple));
  }
  
  .section-header h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.3rem;
    color: var(--text);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .section-icon {
    font-size: 1.2rem;
    color: var(--mint);
  }
  
  .toggle-icon {
    color: var(--mint);
    font-size: 1.2rem;
    transition: transform 0.3s ease;
  }
  
  .section.open .toggle-icon {
    transform: rotate(180deg);
  }
  
  /* Section content */
  .section-content {
    padding: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
  }
  
  .section.open .section-content {
    padding: 1.5rem;
    max-height: 5000px;
  }
  
  /* Tool-specific styles */
  /* Breathing */
  .breathing-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 1rem 0;
  }
  
  .breathing-shape {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--accent) 0%, var(--soft-purple) 70%);
    box-shadow: 0 0 40px rgba(255, 110, 199, 0.8);
    animation: breathe 8s infinite cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 700;
    font-size: 1.2rem;
  }
  
  @keyframes breathe {
    0% { transform: scale(1) rotate(0deg); opacity: 0.7; box-shadow: 0 0 30px rgba(255,110,199,0.6); }
    40% { transform: scale(1.4) rotate(5deg); opacity: 1; box-shadow: 0 0 60px rgba(255,110,199,0.9); }
    60% { transform: scale(1.4) rotate(-5deg); opacity: 1; box-shadow: 0 0 60px rgba(255,110,199,0.9); }
    100% { transform: scale(1) rotate(0deg); opacity: 0.7; box-shadow: 0 0 30px rgba(255,110,199,0.6); }
  }
  
  /* Grounding */
  .grounding-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .grounding-item {
    background: var(--soft-purple);
    border-radius: 10px;
    padding: 1.25rem;
    cursor: pointer;
    transition: var(--transition-smooth);
    border: 2px solid transparent;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .grounding-item:hover {
    background: var(--light-purple);
    transform: translateY(-3px);
    border-color: var(--mint);
  }
  
  .grounding-item.completed {
    background: rgba(0, 247, 224, 0.1);
    border-color: var(--mint);
  }
  
  .grounding-number {
    background: var(--mint);
    color: #111;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    flex-shrink: 0;
  }
  
  .grounding-text {
    font-weight: 500;
  }
  
  /* Audio */
  .audio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .audio-btn {
    background: var(--soft-purple);
    border: none;
    border-radius: 10px;
    padding: 1.5rem 1rem;
    color: var(--text);
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }
  
  .audio-btn:hover {
    background: var(--light-purple);
    transform: translateY(-3px);
  }
  
  .audio-btn.active {
    background: var(--accent);
    color: #111;
    box-shadow: 0 0 20px rgba(255, 110, 199, 0.4);
  }
  
  .audio-btn i {
    font-size: 1.5rem;
  }
  
  .audio-label {
    font-weight: 500;
    font-size: 0.95rem;
  }
  
  /* Timer */
  .timer-display {
    font-size: 3.5rem;
    font-weight: 800;
    color: var(--accent);
    text-align: center;
    margin: 1.5rem 0;
    font-family: 'Montserrat', sans-serif;
    text-shadow: 0 0 20px rgba(255, 110, 199, 0.4);
  }
  
  .timer-controls {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1.5rem;
  }
  
  /* Mantras */
  .mantra-container {
    text-align: center;
    padding: 2rem;
  }
  
  .mantra-text {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--mint);
    margin-bottom: 2rem;
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    background: rgba(0, 247, 224, 0.05);
    border-radius: 12px;
    border: 2px solid rgba(0, 247, 224, 0.2);
    line-height: 1.5;
  }
  
  /* Resource links */
  .resource-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .resource-link {
    display: block;
    background: var(--soft-purple);
    color: var(--text);
    text-decoration: none;
    padding: 1.25rem;
    border-radius: 10px;
    transition: var(--transition-smooth);
    border: 2px solid transparent;
  }
  
  .resource-link:hover {
    background: var(--light-purple);
    transform: translateY(-3px);
    border-color: var(--mint);
  }
  
  .resource-link i {
    color: var(--mint);
    margin-right: 0.5rem;
  }
  
  /* Buttons */
  .btn {
    padding: 0.75rem 1.5rem;
    border-radius: 25px;
    border: none;
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-bounce);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
  }
  
  .btn-primary {
    background: var(--mint);
    color: #111;
  }
  
  .btn-primary:hover {
    background: #00d6c7;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 20px rgba(0, 247, 224, 0.3);
  }
  
  .btn-secondary {
    background: var(--accent);
    color: #111;
  }
  
  .btn-secondary:hover {
    background: #ff49b2;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 20px rgba(255, 110, 199, 0.3);
  }
  
  .btn-outline {
    background: transparent;
    color: var(--mint);
    border: 2px solid var(--mint);
  }
  
  .btn-outline:hover {
    background: rgba(0, 247, 224, 0.1);
    transform: translateY(-3px);
  }
  
  /* Progress indicator */
  .progress-indicator {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--card);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow);
    z-index: 100;
    font-weight: bold;
    color: var(--mint);
    border: 2px solid var(--mint);
  }
  
  /* Mode toggle */
  .mode-toggle {
    position: fixed;
    bottom: 80px;
    right: 20px;
    z-index: 100;
  }
  
  .mode-toggle .btn {
    border-radius: 25px;
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
  }
  
  /* Footer */
  footer {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255,255,255,0.1);
    color: #aaa;
    font-size: 0.9rem;
    grid-column: 1 / -1;
  }
  
  .legal-disclaimer {
    font-size: 0.75rem;
    color: #888;
    margin-top: 1.5rem;
    padding: 1rem;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    line-height: 1.4;
  }
  
  .legal-disclaimer strong {
    color: var(--mint);
    display: block;
    margin-bottom: 0.5rem;
  }
  
  /* Sensory Safe Mode */
  .sensory-safe {
    --bg: #0a0014;
    --card: #150020;
    --accent: #cc5aa3;
    --mint: #00c4b3;
    --text: #ddd;
    --soft-purple: #200030;
    --light-purple: #2a003a;
  }
  
  .sensory-safe .breathing-shape {
    animation-duration: 12s;
    box-shadow: 0 0 20px rgba(204,90,163,0.4);
  }
  
  /* Responsive Design */
  @media (max-width: 1024px) {
    .container {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    .sidebar {
      position: static;
      height: auto;
      top: 0;
    }
    
    body {
      padding-top: 80px;
    }
  }
  
  @media (max-width: 768px) {
    .header-content {
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .menu-toggle {
      display: block;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    
    .nav-links {
      display: none;
      flex-direction: column;
      width: 100%;
      background: var(--card);
      border-radius: 12px;
      padding: 1rem;
      margin-top: 0.5rem;
    }
    
    .nav-links.show {
      display: flex;
    }
    
    .nav-link {
      padding: 0.75rem 1rem;
    }
    
    .section-header h2 {
      font-size: 1.1rem;
    }
    
    .grounding-grid,
    .audio-grid,
    .resource-grid {
      grid-template-columns: 1fr;
    }
    
    .timer-display {
      font-size: 2.5rem;
    }
    
    .breathing-shape {
      width: 120px;
      height: 120px;
    }
    
    .mantra-text {
      font-size: 1.2rem;
      padding: 1rem;
    }
    
    .section {
      margin-bottom: 1rem;
    }
    
    .section.open .section-content {
      padding: 1rem;
    }
  }
  
  @media (max-width: 480px) {
    .header {
      padding: 0.75rem;
    }
    
    .main-title {
      font-size: 1.2rem;
    }
    
    .container {
      padding: 0.75rem;
    }
    
    .timer-controls {
      flex-direction: column;
    }
    
    .btn {
      width: 100%;
      justify-content: center;
    }
    
    .mode-toggle {
      bottom: 70px;
      right: 10px;
    }
    
    .progress-indicator {
      bottom: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      font-size: 0.9rem;
    }
  }
  
  /* Animation delays for sections */
  .section:nth-child(1) { animation-delay: 0.1s; }
  .section:nth-child(2) { animation-delay: 0.2s; }
  .section:nth-child(3) { animation-delay: 0.3s; }
  .section:nth-child(4) { animation-delay: 0.4s; }
  .section:nth-child(5) { animation-delay: 0.5s; }
  .section:nth-child(6) { animation-delay: 0.6s; }
  .section:nth-child(7) { animation-delay: 0.7s; }
  .section:nth-child(8) { animation-delay: 0.8s; }
  .section:nth-child(9) { animation-delay: 0.9s; }
  .section:nth-child(10) { animation-delay: 1s; }
</style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="https://plurderapolis.org" class="main-title">
        <i class="fas fa-peach"></i>
        PLURderapolis Bad Trip Guide
      </a>
      
      <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
      </button>
      
      <ul class="nav-links" id="navLinks">
        <li><a href="#breathing" class="nav-link">Breathing</a></li>
        <li><a href="#grounding" class="nav-link">Grounding</a></li>
        <li><a href="#sounds" class="nav-link">Sounds</a></li>
        <li><a href="#checkin" class="nav-link">Check-In</a></li>
        <li><a href="#shows" class="nav-link">At Shows</a></li>
        <li><a href="#timer" class="nav-link">Timer</a></li>
        <li><a href="#mantras" class="nav-link">Mantras</a></li>
        <li><a href="#aftercare" class="nav-link">Aftercare</a></li>
        <li><a href="#resources" class="nav-link">Resources</a></li>
      </ul>
    </div>
  </header>

  <!-- Main Container -->
  <div class="container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="section-nav">
        <button class="section-btn active" data-target="breathing">
          <i class="fas fa-wind"></i>
          Breathing Exercise
        </button>
        <button class="section-btn" data-target="grounding">
          <i class="fas fa-mountain"></i>
          5-4-3-2-1 Grounding
        </button>
        <button class="section-btn" data-target="sounds">
          <i class="fas fa-music"></i>
          Soothing Sounds
        </button>
        <button class="section-btn" data-target="checkin">
          <i class="fas fa-heartbeat"></i>
          Self Check-In
        </button>
        <button class="section-btn" data-target="shows">
          <i class="fas fa-headphones"></i>
          Tripping at Shows
        </button>
        <button class="section-btn" data-target="timer">
          <i class="fas fa-hourglass-half"></i>
          Calm Timer
        </button>
        <button class="section-btn" data-target="mantras">
          <i class="fas fa-brain"></i>
          Calming Mantras
        </button>
        <button class="section-btn" data-target="aftercare">
          <i class="fas fa-comment-medical"></i>
          Reflection & Aftercare
        </button>
        <button class="section-btn" data-target="resources">
          <i class="fas fa-life-ring"></i>
          Emergency Resources
        </button>
        
        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
          <h3 style="color: var(--mint); font-size: 0.9rem; margin-bottom: 1rem; text-transform: uppercase;">Quick Links</h3>
          <a href="https://plurderapolis.org" class="section-btn" style="text-decoration: none; color: inherit;">
            <i class="fas fa-home"></i>
            PLURderapolis Home
          </a>
          <a href="https://plurderapolis.org/panic.html" class="section-btn" style="text-decoration: none; color: inherit;">
            <i class="fas fa-exclamation-triangle"></i>
            Panic Button
          </a>
          <a href="https://plurderapolis.org/emergency.html" class="section-btn" style="text-decoration: none; color: inherit;">
            <i class="fas fa-ambulance"></i>
            Emergency Help
          </a>
          <button id="downloadCheat" class="section-btn" style="background: var(--mint); color: #111; margin-top: 0.5rem;">
            <i class="fas fa-download"></i>
            Download Cheat Sheet
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Breathing Section -->
      <section id="breathing" class="section open">
        <div class="section-header">
          <h2><i class="fas fa-wind section-icon"></i> Breathing Exercise</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <div class="breathing-container">
            <div id="breathShape" class="breathing-shape">Breathe</div>
            <p style="text-align: center; color: var(--mint); font-weight: 600; max-width: 500px; margin: 0 auto;">
              Follow the circle with your breath. Inhale as it expands, exhale as it contracts. This helps regulate your nervous system.
            </p>
            <div class="timer-controls">
              <button id="pauseBreath" class="btn btn-primary">
                <i class="fas fa-pause"></i> Pause
              </button>
              <button id="resumeBreath" class="btn btn-secondary">
                <i class="fas fa-play"></i> Resume
              </button>
              <button id="stopBreath" class="btn btn-outline">
                <i class="fas fa-stop"></i> Stop
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Grounding Section -->
      <section id="grounding" class="section">
        <div class="section-header">
          <h2><i class="fas fa-mountain section-icon"></i> 5-4-3-2-1 Grounding</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">Engage your senses to bring yourself to the present moment. Click each item as you notice it.</p>
          
          <div class="grounding-grid">
            <div class="grounding-item" data-sense="see">
              <div class="grounding-number">5</div>
              <div class="grounding-text">Things you can SEE</div>
            </div>
            <div class="grounding-item" data-sense="touch">
              <div class="grounding-number">4</div>
              <div class="grounding-text">Things you can TOUCH</div>
            </div>
            <div class="grounding-item" data-sense="hear">
              <div class="grounding-number">3</div>
              <div class="grounding-text">Things you can HEAR</div>
            </div>
            <div class="grounding-item" data-sense="smell">
              <div class="grounding-number">2</div>
              <div class="grounding-text">Things you can SMELL</div>
            </div>
            <div class="grounding-item" data-sense="taste">
              <div class="grounding-number">1</div>
              <div class="grounding-text">Thing you can TASTE</div>
            </div>
          </div>
          
          <div id="groundingComplete" style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: rgba(0, 247, 224, 0.1); border-radius: 10px; text-align: center;">
            <h3 style="color: var(--mint); margin-bottom: 0.5rem;">‚úÖ Grounding Complete!</h3>
            <p>You're anchored in the present moment. Well done.</p>
          </div>
          
          <div style="text-align: center; margin-top: 1.5rem;">
            <button id="resetGrounding" class="btn btn-outline">
              <i class="fas fa-redo"></i> Reset Grounding
            </button>
          </div>
        </div>
      </section>

      <!-- Sounds Section -->
      <section id="sounds" class="section">
        <div class="section-header">
          <h2><i class="fas fa-music section-icon"></i> Soothing Sounds</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">Calm auditory environments to help soothe anxiety. Only one sound plays at a time.</p>
          
          <div class="audio-grid">
            <button class="audio-btn" data-sound="whiteNoise">
              <i class="fas fa-volume-up"></i>
              <span class="audio-label">White Noise</span>
            </button>
            <button class="audio-btn" data-sound="ocean">
              <i class="fas fa-water"></i>
              <span class="audio-label">Ocean Waves</span>
            </button>
            <button class="audio-btn" data-sound="forest">
              <i class="fas fa-tree"></i>
              <span class="audio-label">Forest & Birds</span>
            </button>
            <button class="audio-btn" data-sound="rain">
              <i class="fas fa-cloud-rain"></i>
              <span class="audio-label">Gentle Rain</span>
            </button>
            <button class="audio-btn" data-sound="heartbeat">
              <i class="fas fa-heartbeat"></i>
              <span class="audio-label">Calm Heartbeat</span>
            </button>
            <button class="audio-btn" data-sound="brownNoise">
              <i class="fas fa-sliders-h"></i>
              <span class="audio-label">Brown Noise</span>
            </button>
          </div>
          
          <div style="text-align: center; margin-top: 1.5rem;">
            <button id="stopAllAudio" class="btn btn-outline">
              <i class="fas fa-volume-mute"></i> Stop All Sounds
            </button>
            <div style="margin-top: 1rem; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
              <i class="fas fa-info-circle"></i> Adjust volume using your device controls
            </div>
          </div>
        </div>
      </section>

      <!-- Check-In Section -->
      <section id="checkin" class="section">
        <div class="section-header">
          <h2><i class="fas fa-heartbeat section-icon"></i> Self Check-In</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">A quick checklist to assess your basic needs and comfort.</p>
          
          <div class="grounding-grid">
            <div class="grounding-item" data-check="hydration">
              <div class="grounding-number"><i class="fas fa-tint"></i></div>
              <div class="grounding-text">Hydration: Sip water slowly</div>
            </div>
            <div class="grounding-item" data-check="comfort">
              <div class="grounding-number"><i class="fas fa-tshirt"></i></div>
              <div class="grounding-text">Comfort: Adjust clothing if needed</div>
            </div>
            <div class="grounding-item" data-check="position">
              <div class="grounding-number"><i class="fas fa-couch"></i></div>
              <div class="grounding-text">Position: Sit or lie down safely</div>
            </div>
            <div class="grounding-item" data-check="temperature">
              <div class="grounding-number"><i class="fas fa-thermometer-half"></i></div>
              <div class="grounding-text">Temperature: Adjust if too hot/cold</div>
            </div>
            <div class="grounding-item" data-check="connection">
              <div class="grounding-number"><i class="fas fa-user-friends"></i></div>
              <div class="grounding-text">Connection: Reach out if possible</div>
            </div>
            <div class="grounding-item" data-check="breathing">
              <div class="grounding-number"><i class="fas fa-lungs"></i></div>
              <div class="grounding-text">Breathing: Take 3 deep breaths</div>
            </div>
          </div>
          
          <div style="margin-top: 1.5rem; padding: 1.25rem; background: rgba(255, 110, 199, 0.1); border-radius: 10px;">
            <h3 style="color: var(--accent); margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> Remember</h3>
            <p style="margin: 0;">If you can't do any of these right now, that's okay. Just focus on your breathing and know that this will pass.</p>
          </div>
        </div>
      </section>

      <!-- At Shows Section -->
      <section id="shows" class="section">
        <div class="section-header">
          <h2><i class="fas fa-headphones section-icon"></i> Tripping at Shows</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">Safety tips for managing difficult experiences at music events.</p>
          
          <div style="display: grid; gap: 1rem;">
            <div style="background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 10px; border-left: 4px solid var(--mint);">
              <h4 style="color: var(--mint); margin-bottom: 0.5rem;"><i class="fas fa-tint"></i> Hydration</h4>
              <p style="margin: 0;">Sip water slowly and often. Avoid chugging or sugary drinks.</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 10px; border-left: 4px solid var(--accent);">
              <h4 style="color: var(--accent); margin-bottom: 0.5rem;"><i class="fas fa-map-marker-alt"></i> Environment</h4>
              <p style="margin: 0;">Step outside or find a chill zone if overwhelmed. Quiet spaces help.</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 10px; border-left: 4px solid var(--mint);">
              <h4 style="color: var(--mint); margin-bottom: 0.5rem;"><i class="fas fa-user-friends"></i> Buddy System</h4>
              <p style="margin: 0;">Stay with someone you trust. Check in with each other regularly.</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 10px; border-left: 4px solid var(--accent);">
              <h4 style="color: var(--accent); margin-bottom: 0.5rem;"><i class="fas fa-ban"></i> Avoid Mixing</h4>
              <p style="margin: 0;">Don't mix substances or drink lots of alcohol. Give your body breaks.</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1.25rem; border-radius: 10px; border-left: 4px solid var(--mint);">
              <h4 style="color: var(--mint); margin-bottom: 0.5rem;"><i class="fas fa-tools"></i> Useful Tools</h4>
              <p style="margin: 0;">Sunglasses, earplugs, water bottle, and breathing exercises help.</p>
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 1.5rem;">
            <button id="findHelp" class="btn btn-secondary">
              <i class="fas fa-hands-helping"></i> I Need Help at an Event
            </button>
          </div>
        </div>
      </section>

      <!-- Timer Section -->
      <section id="timer" class="section">
        <div class="section-header">
          <h2><i class="fas fa-hourglass-half section-icon"></i> Calm Timer</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="text-align: center; margin-bottom: 1.5rem;">Intense moments often pass within 10-20 minutes. Use this timer to wait it out safely.</p>
          
          <div class="timer-display" id="timerDisplay">15:00</div>
          
          <div class="timer-controls">
            <button id="startTimer" class="btn btn-primary">
              <i class="fas fa-play"></i> Start
            </button>
            <button id="pauseTimer" class="btn btn-outline">
              <i class="fas fa-pause"></i> Pause
            </button>
            <button id="resetTimer" class="btn btn-secondary">
              <i class="fas fa-redo"></i> Reset
            </button>
            <button id="quick5" class="btn btn-outline">
              <i class="fas fa-bolt"></i> 5 Min
            </button>
            <button id="quick20" class="btn btn-outline">
              <i class="fas fa-clock"></i> 20 Min
            </button>
          </div>
          
          <div id="timerMessage" style="text-align: center; margin-top: 1.5rem; color: var(--mint); font-weight: 500;">
            Many people find things stabilize after ~10-20 minutes
          </div>
          
          <div style="margin-top: 1.5rem; padding: 1.25rem; background: rgba(0, 247, 224, 0.1); border-radius: 10px;">
            <h4 style="color: var(--mint); margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> While You Wait</h4>
            <p style="margin: 0;">Focus on your breathing. Remind yourself: "I just need to get through the next few minutes."</p>
          </div>
        </div>
      </section>

      <!-- Mantras Section -->
      <section id="mantras" class="section">
        <div class="section-header">
          <h2><i class="fas fa-brain section-icon"></i> Calming Mantras</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <div class="mantra-container">
            <div id="mantraText" class="mantra-text">
              I am safe and this will pass.
            </div>
            
            <div class="timer-controls">
              <button id="prevMantra" class="btn btn-outline">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <button id="nextMantra" class="btn btn-secondary">
                Next <i class="fas fa-chevron-right"></i>
              </button>
              <button id="speakMantra" class="btn btn-primary">
                <i class="fas fa-volume-up"></i> Speak
              </button>
            </div>
            
            <div style="margin-top: 2rem;">
              <p style="text-align: center; color: rgba(255,255,255,0.7); font-size: 0.95rem;">
                <i class="fas fa-info-circle"></i> Repeat the mantra slowly in your mind or aloud. Tap to change.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Aftercare Section -->
      <section id="aftercare" class="section">
        <div class="section-header">
          <h2><i class="fas fa-comment-medical section-icon"></i> Reflection & Aftercare</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">After the experience passes, reflection can help integrate insights.</p>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="color: var(--mint); margin-bottom: 0.75rem;">What helped during this experience?</h4>
            <textarea id="reflection1" placeholder="Jot down what worked for you..." 
              style="width:100%; min-height:100px; padding:1rem; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:8px; color:var(--text); font-family:'Roboto', sans-serif; resize:vertical;"></textarea>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="color: var(--mint); margin-bottom: 0.75rem;">What would I try next time?</h4>
            <textarea id="reflection2" placeholder="Note any insights or changes..." 
              style="width:100%; min-height:100px; padding:1rem; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:8px; color:var(--text); font-family:'Roboto', sans-serif; resize:vertical;"></textarea>
          </div>
          
          <div style="background: rgba(255, 110, 199, 0.1); padding: 1.25rem; border-radius: 10px; margin-top: 1.5rem;">
            <h4 style="color: var(--accent); margin-bottom: 0.5rem;"><i class="fas fa-heart"></i> Self-Care After</h4>
            <ul style="padding-left: 1.25rem; margin: 0;">
              <li style="margin-bottom: 0.5rem;">Rest and hydrate</li>
              <li style="margin-bottom: 0.5rem;">Eat nourishing, simple food</li>
              <li style="margin-bottom: 0.5rem;">Talk to someone you trust</li>
              <li>Be gentle with yourself for 24-48 hours</li>
            </ul>
          </div>
          
          <div style="text-align: center; margin-top: 1.5rem;">
            <button id="saveReflection" class="btn btn-secondary">
              <i class="fas fa-save"></i> Save Reflections
            </button>
          </div>
        </div>
      </section>

      <!-- Resources Section -->
      <section id="resources" class="section">
        <div class="section-header">
          <h2><i class="fas fa-life-ring section-icon"></i> Emergency Resources</h2>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
        <div class="section-content">
          <p style="margin-bottom: 1.5rem;">If you need human support right now, these resources are available:</p>
          
          <div class="resource-grid">
            <a href="https://tripsit.me/" target="_blank" class="resource-link">
              <i class="fas fa-comments"></i> TripSit ‚Äî Live Chat & Resources
            </a>
            <a href="https://firesideproject.org/" target="_blank" class="resource-link">
              <i class="fas fa-phone-alt"></i> Fireside Project ‚Äî Support Line
            </a>
            <a href="https://neverusealone.com/" target="_blank" class="resource-link">
              <i class="fas fa-user-check"></i> Never Use Alone ‚Äî Phone Check
            </a>
            <a href="https://plurderapolis.org/panic.html" class="resource-link">
              <i class="fas fa-exclamation-triangle"></i> Panic Button (PLURderapolis)
            </a>
            <a href="https://plurderapolis.org/emergency.html" class="resource-link">
              <i class="fas fa-ambulance"></i> Emergency Help (PLURderapolis)
            </a>
            <a href="https://plurderapolis.org" class="resource-link">
              <i class="fas fa-home"></i> PLURderapolis Home
            </a>
          </div>
          
          <div style="background: rgba(255, 50, 50, 0.1); padding: 1.25rem; border-radius: 10px; margin-top: 1.5rem; border: 2px solid rgba(255, 50, 50, 0.3);">
            <h4 style="color: #ff6b6b; margin-bottom: 0.5rem;"><i class="fas fa-exclamation-circle"></i> Medical Emergency</h4>
            <p style="margin: 0;">If you or someone else is experiencing a medical emergency, call 911 or your local emergency services immediately.</p>
          </div>
          
          <div style="text-align: center; margin-top: 1.5rem;">
            <button id="imOk" class="btn btn-primary">
              <i class="fas fa-smile"></i> I'm Feeling Better Now
            </button>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer>
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h3 style="color: var(--mint); margin-bottom: 0.5rem;">PLURderapolis</h3>
          <p style="color: rgba(255,255,255,0.7);">Your partners in shine üçë</p>
        </div>
        
        <div class="legal-disclaimer">
          <strong>Disclaimer:</strong>
          This guide is provided for educational and harm reduction purposes only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition. If you are experiencing a medical emergency, please call emergency services immediately. PLURderapolis is not responsible for any actions taken based on the information provided on this site. Use responsibly.
        </div>
      </footer>
    </main>
  </div>

  <!-- Mode Toggle -->
  <div class="mode-toggle">
    <button id="toggleSafe" class="btn btn-outline">
      <i class="fas fa-moon"></i> Sensory Safe Mode
    </button>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-indicator" id="progressIndicator">
    1/9
  </div>

<script>
// Initialize variables
let currentSection = 'breathing';
let audioContext = null;
let currentSound = null;
let timerInterval = null;
let timeLeft = 900; // 15 minutes in seconds
let mantraIndex = 0;
let speechSynthesis = window.speechSynthesis;
let breathingAnimation = null;

// Mantras array
const mantras = [
  "I am safe and this will pass.",
  "This feeling is temporary ‚Äî I can wait.",
  "I can breathe. I can slow down.",
  "I have survived this before. I will again.",
  "Small steps. One breath at a time.",
  "I am not my thoughts. I am the observer.",
  "This too shall pass. Everything changes.",
  "I am exactly where I need to be.",
  "I release what I cannot control.",
  "I am supported by the universe."
];

// Section order for progress tracking
const sectionOrder = [
  'breathing', 'grounding', 'sounds', 'checkin', 
  'shows', 'timer', 'mantras', 'aftercare', 'resources'
];

// Initialize page
document.addEventListener('DOMContentLoaded', () => {
  initMenu();
  initSections();
  initBreathing();
  initGrounding();
  initAudio();
  initTimer();
  initMantras();
  initEventListeners();
  updateProgressIndicator();
});

// Mobile menu toggle
function initMenu() {
  const menuToggle = document.getElementById('menuToggle');
  const navLinks = document.getElementById('navLinks');
  
  menuToggle.addEventListener('click', () => {
    navLinks.classList.toggle('show');
    menuToggle.innerHTML = navLinks.classList.contains('show') 
      ? '<i class="fas fa-times"></i>' 
      : '<i class="fas fa-bars"></i>';
  });
  
  // Close menu when clicking a link
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
      navLinks.classList.remove('show');
      menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
    });
  });
}

// Section management
function initSections() {
  // Collapsible section functionality
  document.querySelectorAll('.section-header').forEach(header => {
    header.addEventListener('click', () => {
      const section = header.parentElement;
      const isOpening = !section.classList.contains('open');
      
      // Close all other sections on mobile
      if (window.innerWidth <= 768 && isOpening) {
        document.querySelectorAll('.section').forEach(s => {
          if (s !== section && s.classList.contains('open')) {
            s.classList.remove('open');
            updateSectionButton(s.id, false);
          }
        });
      }
      
      // Toggle current section
      section.classList.toggle('open');
      updateSectionButton(section.id, section.classList.contains('open'));
      
      // Update current section and progress
      if (section.classList.contains('open')) {
        currentSection = section.id;
        updateProgressIndicator();
        
        // Smooth scroll to section
        setTimeout(() => {
          section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 300);
      }
    });
  });
  
  // Sidebar navigation
  document.querySelectorAll('.section-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.target;
      
      // Close all sections on mobile
      if (window.innerWidth <= 768) {
        document.querySelectorAll('.section').forEach(section => {
          section.classList.remove('open');
          updateSectionButton(section.id, false);
        });
      }
      
      // Open target section
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.classList.add('open');
        updateSectionButton(targetId, true);
        currentSection = targetId;
        updateProgressIndicator();
        
        // Smooth scroll to section
        setTimeout(() => {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
      
      // Update active button
      document.querySelectorAll('.section-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });
  
  // Update section button state
  function updateSectionButton(sectionId, isOpen) {
    const btn = document.querySelector(`.section-btn[data-target="${sectionId}"]`);
    if (btn) {
      btn.classList.toggle('active', isOpen);
    }
  }
  
  // Intersection Observer for active section tracking
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
        const section = entry.target;
        currentSection = section.id;
        updateProgressIndicator();
        
        // Update active button
        document.querySelectorAll('.section-btn').forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.querySelector(`.section-btn[data-target="${section.id}"]`);
        if (activeBtn) activeBtn.classList.add('active');
      }
    });
  }, {
    threshold: 0.5,
    rootMargin: '-100px 0px -100px 0px'
  });
  
  // Observe all sections
  document.querySelectorAll('.section').forEach(section => {
    observer.observe(section);
  });
}

// Breathing functionality
function initBreathing() {
  const breathShape = document.getElementById('breathShape');
  let isBreathing = true;
  
  // Start breathing animation
  breathingAnimation = breathShape.style.animation = 'breathe 8s infinite cubic-bezier(0.4, 0, 0.2, 1)';
  
  // Control buttons
  document.getElementById('pauseBreath').addEventListener('click', () => {
    breathShape.style.animationPlayState = 'paused';
    breathShape.textContent = 'Paused';
  });
  
  document.getElementById('resumeBreath').addEventListener('click', () => {
    breathShape.style.animationPlayState = 'running';
    breathShape.textContent = 'Breathe';
  });
  
  document.getElementById('stopBreath').addEventListener('click', () => {
    breathShape.style.animation = 'none';
    setTimeout(() => {
      breathShape.style.animation = breathingAnimation;
    }, 10);
  });
}

// Grounding functionality
function initGrounding() {
  const groundingItems = document.querySelectorAll('.grounding-item');
  const groundingComplete = document.getElementById('groundingComplete');
  let completedCount = 0;
  
  groundingItems.forEach(item => {
    item.addEventListener('click', () => {
      if (!item.classList.contains('completed')) {
        item.classList.add('completed');
        completedCount++;
        
        // Add completion animation
        item.style.transform = 'scale(0.98)';
        setTimeout(() => {
          item.style.transform = '';
        }, 200);
        
        // Check if all are completed
        if (completedCount >= groundingItems.length) {
          groundingComplete.style.display = 'block';
          setTimeout(() => {
            groundingComplete.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 500);
        }
      }
    });
  });
  
  // Reset grounding
  document.getElementById('resetGrounding').addEventListener('click', () => {
    groundingItems.forEach(item => {
      item.classList.remove('completed');
    });
    groundingComplete.style.display = 'none';
    completedCount = 0;
  });
}

// Audio functionality with improved sounds
function initAudio() {
  // Initialize audio context on first user interaction
  document.addEventListener('click', initAudioContext, { once: true });
  
  // Audio button functionality
  document.querySelectorAll('.audio-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const soundType = this.dataset.sound;
      
      // If this sound is already playing, stop it
      if (this.classList.contains('active')) {
        stopCurrentSound();
        return;
      }
      
      // Stop any currently playing sound
      stopCurrentSound();
      
      // Play new sound
      playSound(soundType);
      this.classList.add('active');
    });
  });
  
  // Stop all audio
  document.getElementById('stopAllAudio').addEventListener('click', stopCurrentSound);
}

function initAudioContext() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playSound(type) {
  if (!audioContext) initAudioContext();
  
  stopCurrentSound();
  
  switch(type) {
    case 'whiteNoise':
      currentSound = createWhiteNoise();
      break;
    case 'ocean':
      currentSound = createOceanWaves();
      break;
    case 'forest':
      currentSound = createForestSounds();
      break;
    case 'rain':
      currentSound = createRainSound();
      break;
    case 'heartbeat':
      currentSound = createHeartbeat();
      break;
    case 'brownNoise':
      currentSound = createBrownNoise();
      break;
  }
}

function stopCurrentSound() {
  if (currentSound) {
    currentSound.stop();
    currentSound = null;
  }
  
  // Update button states
  document.querySelectorAll('.audio-btn').forEach(btn => {
    btn.classList.remove('active');
  });
}

// Sound generators
function createWhiteNoise() {
  const bufferSize = 2 * audioContext.sampleRate;
  const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
  const data = buffer.getChannelData(0);
  
  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }
  
  const source = audioContext.createBufferSource();
  source.buffer = buffer;
  source.loop = true;
  
  const gainNode = audioContext.createGain();
  gainNode.gain.value = 0.1;
  
  source.connect(gainNode);
  gainNode.connect(audioContext.destination);
  source.start();
  
  return source;
}

function createOceanWaves() {
  // Create main wave oscillator (low frequency)
  const waveOsc = audioContext.createOscillator();
  waveOsc.type = 'sine';
  waveOsc.frequency.value = 60;
  
  // Create wave LFO for rolling effect
  const waveLFO = audioContext.createOscillator();
  waveLFO.type = 'sine';
  waveLFO.frequency.value = 0.1;
  
  const waveLFOGain = audioContext.createGain();
  waveLFOGain.gain.value = 20;
  
  waveLFO.connect(waveLFOGain);
  waveLFOGain.connect(waveOsc.frequency);
  
  // Create occasional splash sounds
  const splashNoise = audioContext.createBufferSource();
  const splashBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate);
  const splashData = splashBuffer.getChannelData(0);
  
  for (let i = 0; i < splashBuffer.length; i++) {
    splashData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (audioContext.sampleRate * 0.05));
  }
  
  splashNoise.buffer = splashBuffer;
  splashNoise.loop = true;
  
  const splashGain = audioContext.createGain();
  splashGain.gain.value = 0.05;
  
  // Schedule splashes randomly
  const scheduleSplash = () => {
    const now = audioContext.currentTime;
    const nextSplash = now + 2 + Math.random() * 3;
    
    splashGain.gain.setValueAtTime(0, now);
    splashGain.gain.linearRampToValueAtTime(0.05, nextSplash);
    splashGain.gain.linearRampToValueAtTime(0, nextSplash + 0.3);
    
    setTimeout(scheduleSplash, (nextSplash - now + 0.3) * 1000);
  };
  
  // Connect everything
  const masterGain = audioContext.createGain();
  masterGain.gain.value = 0.15;
  
  waveOsc.connect(masterGain);
  splashNoise.connect(splashGain);
  splashGain.connect(masterGain);
  masterGain.connect(audioContext.destination);
  
  // Start oscillators
  waveOsc.start();
  waveLFO.start();
  splashNoise.start();
  
  // Schedule first splash
  setTimeout(scheduleSplash, 1000);
  
  return {
    stop: () => {
      waveOsc.stop();
      waveLFO.stop();
      splashNoise.stop();
    }
  };
}

function createForestSounds() {
  // Create background wind noise
  const windNoise = audioContext.createBufferSource();
  const windBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 2, audioContext.sampleRate);
  const windData = windBuffer.getChannelData(0);
  
  for (let i = 0; i < windBuffer.length; i++) {
    windData[i] = (Math.random() * 2 - 1) * 0.3;
  }
  
  windNoise.buffer = windBuffer;
  windNoise.loop = true;
  
  const windGain = audioContext.createGain();
  windGain.gain.value = 0.02;
  
  // Create bird chirps
  const createBirdChirp = (freq, time) => {
    const birdOsc = audioContext.createOscillator();
    birdOsc.type = 'sine';
    birdOsc.frequency.value = freq;
    
    const birdGain = audioContext.createGain();
    birdGain.gain.setValueAtTime(0, time);
    birdGain.gain.linearRampToValueAtTime(0.1, time + 0.05);
    birdGain.gain.exponentialRampToValueAtTime(0.001, time + 0.3);
    
    birdOsc.connect(birdGain);
    birdGain.connect(audioContext.destination);
    
    birdOsc.start(time);
    birdOsc.stop(time + 0.3);
  };
  
  // Schedule random bird chirps
  const scheduleBirdChirp = () => {
    const now = audioContext.currentTime;
    const nextChirp = now + 0.5 + Math.random() * 2;
    const freq = 800 + Math.random() * 800;
    
    createBirdChirp(freq, nextChirp);
    setTimeout(scheduleBirdChirp, (nextChirp - now) * 1000);
  };
  
  // Connect wind
  windNoise.connect(windGain);
  windGain.connect(audioContext.destination);
  
  // Start
  windNoise.start();
  
  // Schedule first bird chirp
  setTimeout(scheduleBirdChirp, 500);
  
  return {
    stop: () => {
      windNoise.stop();
    }
  };
}

function createRainSound() {
  // Create rain noise buffer
  const rainNoise = audioContext.createBufferSource();
  const rainBuffer = audioContext.createBuffer(1, audioContext.sampleRate, audioContext.sampleRate);
  const rainData = rainBuffer.getChannelData(0);
  
  for (let i = 0; i < rainBuffer.length; i++) {
    rainData[i] = (Math.random() * 2 - 1) * 0.5;
  }
  
  rainNoise.buffer = rainBuffer;
  rainNoise.loop = true;
  
  // Create filter for rain sound
  const filter = audioContext.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.value = 1000;
  
  // Create occasional droplet sounds
  const createDroplet = (time) => {
    const dropletOsc = audioContext.createOscillator();
    dropletOsc.type = 'sine';
    dropletOsc.frequency.value = 400 + Math.random() * 200;
    
    const dropletGain = audioContext.createGain();
    dropletGain.gain.setValueAtTime(0, time);
    dropletGain.gain.linearRampToValueAtTime(0.05, time + 0.01);
    dropletGain.gain.exponentialRampToValueAtTime(0.001, time + 0.1);
    
    dropletOsc.connect(dropletGain);
    dropletGain.connect(audioContext.destination);
    
    dropletOsc.start(time);
    dropletOsc.stop(time + 0.1);
  };
  
  // Schedule random droplets
  const scheduleDroplet = () => {
    const now = audioContext.currentTime;
    const nextDroplet = now + 0.1 + Math.random() * 0.5;
    
    createDroplet(nextDroplet);
    setTimeout(scheduleDroplet, (nextDroplet - now) * 1000);
  };
  
  // Connect rain noise
  const rainGain = audioContext.createGain();
  rainGain.gain.value = 0.08;
  
  rainNoise.connect(filter);
  filter.connect(rainGain);
  rainGain.connect(audioContext.destination);
  
  // Start
  rainNoise.start();
  
  // Schedule first droplet
  setTimeout(scheduleDroplet, 200);
  
  return {
    stop: () => {
      rainNoise.stop();
    }
  };
}

function createHeartbeat() {
  const heartOsc = audioContext.createOscillator();
  heartOsc.type = 'sine';
  heartOsc.frequency.value = 60;
  
  const heartGain = audioContext.createGain();
  
  // Create heartbeat pattern
  const createBeat = (time) => {
    heartGain.gain.setValueAtTime(0, time);
    heartGain.gain.linearRampToValueAtTime(0.1, time + 0.1);
    heartGain.gain.exponentialRampToValueAtTime(0.001, time + 0.2);
  };
  
  // Schedule beats
  let beatCount = 0;
  const scheduleBeat = () => {
    const now = audioContext.currentTime;
    const nextBeat = now + (beatCount % 3 === 0 ? 0.8 : 0.4);
    
    createBeat(nextBeat);
    beatCount++;
    setTimeout(scheduleBeat, (nextBeat - now) * 1000);
  };
  
  // Connect
  heartOsc.connect(heartGain);
  heartGain.connect(audioContext.destination);
  
  // Start
  heartOsc.start();
  
  // Schedule first beat
  setTimeout(scheduleBeat, 100);
  
  return {
    stop: () => {
      heartOsc.stop();
    }
  };
}

function createBrownNoise() {
  const bufferSize = 2 * audioContext.sampleRate;
  const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
  const data = buffer.getChannelData(0);
  
  let lastOut = 0;
  for (let i = 0; i < bufferSize; i++) {
    const white = Math.random() * 2 - 1;
    data[i] = (lastOut + (0.02 * white)) / 1.02;
    lastOut = data[i];
    data[i] *= 3.5;
  }
  
  const source = audioContext.createBufferSource();
  source.buffer = buffer;
  source.loop = true;
  
  const filter = audioContext.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.value = 500;
  
  const gainNode = audioContext.createGain();
  gainNode.gain.value = 0.15;
  
  source.connect(filter);
  filter.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  source.start();
  
  return source;
}

// Timer functionality
function initTimer() {
  const timerDisplay = document.getElementById('timerDisplay');
  const timerMessage = document.getElementById('timerMessage');
  
  // Update timer display
  function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Update message based on time
    if (timeLeft === 600) {
      timerMessage.textContent = "10 minutes left. You're doing great.";
    } else if (timeLeft === 300) {
      timerMessage.textContent = "5 minutes left. Almost there.";
    } else if (timeLeft === 0) {
      timerMessage.textContent = "Time's up. How are you feeling now?";
    }
  }
  
  // Timer controls
  document.getElementById('startTimer').addEventListener('click', () => {
    if (timerInterval) return;
    
    timerInterval = setInterval(() => {
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerInterval = null;
        return;
      }
      timeLeft--;
      updateTimerDisplay();
    }, 1000);
    
    timerMessage.textContent = "Timer started. Focus on your breathing.";
  });
  
  document.getElementById('pauseTimer').addEventListener('click', () => {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
      timerMessage.textContent = "Timer paused. Resume when ready.";
    }
  });
  
  document.getElementById('resetTimer').addEventListener('click', () => {
    clearInterval(timerInterval);
    timerInterval = null;
    timeLeft = 900;
    updateTimerDisplay();
    timerMessage.textContent = "Timer reset. Many people find things stabilize after ~10-20 minutes";
  });
  
  // Quick timer buttons
  document.getElementById('quick5').addEventListener('click', () => {
    clearInterval(timerInterval);
    timerInterval = null;
    timeLeft = 300;
    updateTimerDisplay();
    timerMessage.textContent = "Set to 5 minutes. Start when ready.";
  });
  
  document.getElementById('quick20').addEventListener('click', () => {
    clearInterval(timerInterval);
    timerInterval = null;
    timeLeft = 1200;
    updateTimerDisplay();
    timerMessage.textContent = "Set to 20 minutes. Start when ready.";
  });
  
  // Initialize display
  updateTimerDisplay();
}

// Mantras functionality
function initMantras() {
  const mantraText = document.getElementById('mantraText');
  
  // Display current mantra
  function updateMantra() {
    mantraText.textContent = mantras[mantraIndex];
  }
  
  // Next mantra
  document.getElementById('nextMantra').addEventListener('click', () => {
    mantraIndex = (mantraIndex + 1) % mantras.length;
    updateMantra();
  });
  
  // Previous mantra
  document.getElementById('prevMantra').addEventListener('click', () => {
    mantraIndex = (mantraIndex - 1 + mantras.length) % mantras.length;
    updateMantra();
  });
  
  // Speak mantra
  document.getElementById('speakMantra').addEventListener('click', () => {
    if (speechSynthesis.speaking) {
      speechSynthesis.cancel();
      return;
    }
    
    const utterance = new SpeechSynthesisUtterance(mantras[mantraIndex]);
    utterance.rate = 0.8;
    utterance.pitch = 1;
    utterance.volume = 1;
    
    speechSynthesis.speak(utterance);
  });
  
  // Tap mantra to change
  mantraText.addEventListener('click', () => {
    mantraIndex = (mantraIndex + 1) % mantras.length;
    updateMantra();
  });
  
  // Initialize
  updateMantra();
}

// Event listeners for various buttons
function initEventListeners() {
  // Sensory safe mode
  document.getElementById('toggleSafe').addEventListener('click', () => {
    const isSafeMode = document.body.classList.toggle('sensory-safe');
    const btn = document.getElementById('toggleSafe');
    btn.innerHTML = isSafeMode 
      ? '<i class="fas fa-moon"></i> Safe Mode (On)' 
      : '<i class="fas fa-moon"></i> Sensory Safe Mode';
    
    // Stop all audio when entering safe mode
    if (isSafeMode) {
      stopCurrentSound();
    }
  });
  
  // Find help at event
  document.getElementById('findHelp').addEventListener('click', () => {
    alert("At an event:\n1. Find medical tent or first aid\n2. Look for 'chill zone' or 'safe space'\n3. Ask staff for help\n4. Call/text a trusted friend\n5. Use breathing exercises");
  });
  
  // Save reflections
  document.getElementById('saveReflection').addEventListener('click', () => {
    const reflection1 = document.getElementById('reflection1').value;
    const reflection2 = document.getElementById('reflection2').value;
    
    if (reflection1 || reflection2) {
      localStorage.setItem('badTripReflection', JSON.stringify({
        date: new Date().toISOString(),
        reflection1,
        reflection2
      }));
      
      alert("Reflections saved locally in your browser.");
    } else {
      alert("Please write something before saving.");
    }
  });
  
  // I'm OK button
  document.getElementById('imOk').addEventListener('click', () => {
    if (confirm("Glad you're feeling better! Would you like to visit the PLURderapolis homepage?")) {
      window.location.href = "https://plurderapolis.org";
    }
  });
  
  // Download cheat sheet
  document.getElementById('downloadCheat').addEventListener('click', () => {
    const cheatSheet = `
<!DOCTYPE html>
<html>
<head>
<title>Bad Trip Guide Cheat Sheet</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
  h1 { color: #1c0028; }
  .section { margin-bottom: 30px; padding: 20px; background: #f5f5f5; border-radius: 10px; }
  .emergency { background: #fff0f0; border-left: 4px solid red; }
</style>
</head>
<body>
  <h1>Bad Trip Guide Cheat Sheet</h1>
  <p>Generated from PLURderapolis.org on ${new Date().toLocaleDateString()}</p>
  
  <div class="section">
    <h2>üå¨Ô∏è Breathing (4-7-8 Method)</h2>
    <p>Inhale 4 sec ‚Üí Hold 7 sec ‚Üí Exhale 8 sec</p>
  </div>
  
  <div class="section">
    <h2>ü™® 5-4-3-2-1 Grounding</h2>
    <p>5 things you SEE, 4 TOUCH, 3 HEAR, 2 SMELL, 1 TASTE</p>
  </div>
  
  <div class="section">
    <h2>üßç Self Check-In</h2>
    <p>Hydrate ‚Üí Comfort ‚Üí Position ‚Üí Temperature ‚Üí Connection</p>
  </div>
  
  <div class="section emergency">
    <h2>üö® Emergency Contacts</h2>
    <p>TripSit: tripsit.me<br>Fireside: firesideproject.org<br>Never Use Alone: neverusealone.com<br>Medical: Call 911</p>
  </div>
  
  <p>Full guide: https://plurderapolis.org</p>
</body>
</html>`;
    
    const blob = new Blob([cheatSheet], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'Bad_Trip_Guide_Cheat_Sheet.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });
}

// Progress indicator
function updateProgressIndicator() {
  const index = sectionOrder.indexOf(currentSection);
  const progress = document.getElementById('progressIndicator');
  
  if (index !== -1) {
    progress.textContent = `${index + 1}/${sectionOrder.length}`;
    
    // Pulse animation
    progress.style.transform = 'scale(1.1)';
    setTimeout(() => {
      progress.style.transform = 'scale(1)';
    }, 200);
  }
}

// Smooth scrolling for navigation links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function(e) {
    e.preventDefault();
    const targetId = this.getAttribute('href').substring(1);
    const targetSection = document.getElementById(targetId);
    
    if (targetSection) {
      // Open section if closed
      if (!targetSection.classList.contains('open')) {
        targetSection.classList.add('open');
        
        // Update sidebar button
        const btn = document.querySelector(`.section-btn[data-target="${targetId}"]`);
        if (btn) btn.classList.add('active');
      }
      
      // Smooth scroll to section
      setTimeout(() => {
        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    }
  });
});

// Prevent overlapping on resize
window.addEventListener('resize', () => {
  // Close sidebar on mobile when opening sections
  const navLinks = document.getElementById('navLinks');
  if (window.innerWidth <= 768 && navLinks.classList.contains('show')) {
    navLinks.classList.remove('show');
    document.getElementById('menuToggle').innerHTML = '<i class="fas fa-bars"></i>';
  }
});

// Initialize audio context on any click (for iOS)
document.addEventListener('click', () => {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}, { once: true });
</script>
</body>
</html>
