<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bad Trip Mode â€” PLURderapolis</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto&display=swap" rel="stylesheet">
<style>
  /* Base theme */
  :root{
    --bg:#1c0028;
    --card:#2a0040;
    --accent:#ff6ec7;
    --mint:#00f7e0;
    --text:#eee;
  }
  html,body{height:100%}
  body{
    margin:0; padding:1rem; font-family:'Roboto',sans-serif;
    background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
  }
  h1,h2{font-family:'Montserrat',sans-serif; text-align:center; margin:1rem 0}
  h1{font-size:2rem; color:var(--accent); text-shadow:0 0 8px #ff6ec7aa;}
  h2{
    background:var(--card); color:var(--mint);
    padding:.8rem; border-radius:8px; cursor:pointer;
    box-shadow:0 0 10px #00f7e055; transition:background .2s;
  }
  h2:hover{background:#3a0055}
  main{max-width:780px; margin:0 auto}
  /* Collapsible */
  .collapsible-content{display:none; padding:1rem; margin:.5rem 0 1.2rem; background:var(--card); border-radius:8px; box-shadow:0 0 15px #00000055}
  .collapsible-content.open{display:block}
  /* Controls */
  .top-controls{display:flex;gap:1rem;justify-content:center;margin:1rem 0;flex-wrap:wrap}
  .mode-btn{
    background:var(--mint); color:#111; font-family:'Montserrat',sans-serif; font-weight:700;
    border:none;border-radius:25px;padding:.6rem 1rem;cursor:pointer;box-shadow:0 0 8px #00f7e0aa;
  }
  .mode-btn:hover{background:#00d6c7}
  /* progress */
  #progressContainer{width:100%;background:#222;border-radius:8px;height:12px;margin:1rem 0}
  #progressBar{width:0;height:100%;background:var(--accent);border-radius:8px;transition:width .4s ease}
  /* breathing */
  .breath-row{display:flex;gap:0.6rem;flex-wrap:wrap;justify-content:center;margin-bottom:1rem}
  .breath-btn{padding:.45rem .9rem;border-radius:20px;border:none;background:var(--mint);color:#112;cursor:pointer;font-weight:700;box-shadow:0 0 8px #00f7e0aa}
  .breath-btn:hover{background:#00d6c7}
  .breathing-container{display:flex;flex-direction:column;align-items:center;gap:.75rem;margin:0 auto}
  .breathing-shape{width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,var(--accent)20%,#2a0040 90%);box-shadow:0 0 20px #ff6ec7aa; animation:breathe 8s infinite}
  @keyframes breathe{0%{transform:scale(1);opacity:.75}40%{transform:scale(1.45);opacity:1}60%{transform:scale(1.45);opacity:1}100%{transform:scale(1);opacity:.75}}
  .square{border-radius:14px;background:var(--mint);animation:squareBreathe 8s infinite}
  @keyframes squareBreathe{0%{transform:scale(1);opacity:.75}50%{transform:scale(1.3);opacity:1}100%{transform:scale(1);opacity:.75}}
  .wave{border-radius:30%/40%;background:linear-gradient(90deg,var(--accent),var(--mint));animation:waveBreathe 8s infinite}
  @keyframes waveBreathe{0%{transform:scaleY(1)}50%{transform:scaleY(1.45)}100%{transform:scaleY(1)}}
  /* grounding */
  .ground-list{list-style:disc;padding-left:1.1rem}
  .ground-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
  .ground-btn{
    background:var(--mint); color:#111; padding:.6rem .8rem; border-radius:18px; border:none; cursor:pointer; font-weight:700;
    box-shadow:0 0 8px #00f7e0aa;
  }
  .ground-btn.done{background:#444;color:#ccc;text-decoration:line-through;box-shadow:none;cursor:default}
  /* sounds */
  .audio-controls{display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;margin-top:.5rem}
  .audio-btn{padding:.45rem .9rem;border-radius:20px;border:none;background:var(--mint);color:#112;cursor:pointer;font-weight:700;box-shadow:0 0 8px #00f7e0aa}
  .audio-btn.playing{background:var(--accent); color:#111}
  .audio-btn:hover{opacity:.95}
  /* mantras */
  .mantra-box{display:flex;flex-direction:column;align-items:center;gap:.6rem}
  .mantra-text{font-weight:700;color:var(--mint);font-size:1.05rem;text-align:center;padding:.6rem 1rem;border-radius:12px;background:rgba(255,255,255,0.02);cursor:pointer}
  .mantra-next{padding:.45rem .9rem;border-radius:20px;border:none;background:var(--accent);color:#111;font-weight:800;box-shadow:0 0 8px #ff6ec7aa;cursor:pointer}
  /* timer */
  .timer-display{font-size:2rem;font-weight:800;color:var(--accent);text-align:center;margin:1rem 0;text-shadow:0 0 8px #ff6ec7e0}
  .timer-controls{display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap}
  .timer-btn{padding:.45rem .9rem;border-radius:20px;border:none;background:var(--mint);color:#111;font-weight:700;box-shadow:0 0 8px #00f7e0aa}
  /* resources */
  .resource-btn{display:block;width:100%;padding:.6rem 1rem;border-radius:20px;border:none;background:var(--accent);color:#111;font-weight:800;margin:.4rem 0;text-align:center;text-decoration:none;box-shadow:0 0 8px #ff6ec7aa}
  .resource-btn:hover{background:#ff49b2}
  /* encouraging */
  .encouragement{display:none;text-align:center;font-weight:800;color:var(--mint);margin:.6rem 0}
  footer{color:#aaa;text-align:center;margin:2rem 0 1rem;font-size:.9rem}
  /* responsive */
  @media (max-width:520px){
    .ground-grid{grid-template-columns:1fr}
    .breathing-shape{width:88px;height:88px}
  }
</style>
</head>
<body>
  <main>
    <header>
      <h1>ğŸ‘ Bad Trip Guide â€” PLURderapolis</h1>
      <div class="top-controls" role="toolbar" aria-label="Top controls">
        <button id="toggleSafe" class="mode-btn" aria-pressed="false">ğŸŒ™ Sensory Safe</button>
        <button id="guidedMode" class="mode-btn">â¡ï¸ Guided Start</button>
        <button id="modularMode" class="mode-btn">ğŸ”€ Modular Mode</button>
      </div>
      <div id="progressContainer" aria-hidden="true"><div id="progressBar"></div></div>
    </header>

    <!-- Start Here (intro) -->
    <section class="step-section" data-step="0">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="intro">ğŸŒŸ Start Here</h2>
      <div id="intro" class="collapsible-content" aria-hidden="true">
        <p style="font-weight:700; text-align:center">You are safe. This page will walk you through grounding and calming tools â€” either step-by-step or pick what helps.</p>
        <p style="text-align:center">If things feel intense: slow your breath, drink water, and use the emergency links at the bottom.</p>
      </div>
    </section>

    <!-- Breathing -->
    <section class="step-section" data-step="1">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="breathing">ğŸ’¨ Breathing Exercise</h2>
      <div id="breathing" class="collapsible-content" aria-hidden="true">
        <div class="breath-row" role="radiogroup" aria-label="Breathing visuals">
          <button class="breath-btn" data-shape="breathing-shape" aria-checked="true">Circle</button>
          <button class="breath-btn" data-shape="square">Square</button>
          <button class="breath-btn" data-shape="wave">Wave</button>
        </div>
        <div class="breathing-container" aria-hidden="false">
          <div id="breathShape" class="breathing-shape" aria-hidden="true"></div>
          <div style="text-align:center;font-weight:700;color:var(--mint)">Breathe with the shape â€” inhale as it expands, exhale as it shrinks.</div>
        </div>
      </div>
    </section>

    <!-- Grounding -->
    <section class="step-section" data-step="2">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="grounding">ğŸª¨ Ground Yourself â€” 5-4-3-2-1</h2>
      <div id="grounding" class="collapsible-content" aria-hidden="true">
        <p>Click each item as you name it. When all five are done you'll see a completion message.</p>
        <div class="ground-grid" aria-live="polite">
          <button class="ground-btn" data-count="5">ğŸ‘€ Name 5 things you can see</button>
          <button class="ground-btn" data-count="4">âœ‹ Name 4 things you can touch</button>
          <button class="ground-btn" data-count="3">ğŸ‘‚ Name 3 things you can hear</button>
          <button class="ground-btn" data-count="2">ğŸ‘ƒ Name 2 things you can smell</button>
          <button class="ground-btn" data-count="1">ğŸ‘… Name 1 thing you can taste</button>
        </div>
        <p id="groundingComplete" style="display:none;margin-top:1rem;font-weight:900;color:var(--accent);text-align:center">âœ… Grounding complete â€” you're safe.</p>
      </div>
    </section>

    <!-- Soothing Sounds -->
    <section class="step-section" data-step="3">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="sounds">ğŸ¶ Soothing Sounds</h2>
      <div id="sounds" class="collapsible-content" aria-hidden="true">
        <p style="text-align:center">Tap a sound to toggle play/pause. Only one sound plays at a time. Use Stop All to end every sound.</p>
        <div class="audio-controls" role="group" aria-label="Sound options">
          <button class="audio-btn" data-sound="whiteNoise">White Noise</button>
          <button class="audio-btn" data-sound="ocean">Ocean Waves</button>
          <button class="audio-btn" data-sound="rain">Rain / Thunder</button>
          <button class="audio-btn" data-sound="forest">Forest / Birds</button>
          <button class="audio-btn" id="stopAll">Stop All</button>
        </div>

        <!-- Clean, royalty-free calm samples (Pixabay CDN). They loop and start paused. -->
        <audio id="whiteNoise" loop preload="none" src="https://cdn.pixabay.com/download/audio/2021/09/09/audio_9c5b5b9b4a.mp3?filename=white-noise-ambient-110351.mp3"></audio>
        <audio id="ocean" loop preload="none" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_1774b82618.mp3?filename=ocean-waves-108554.mp3"></audio>
        <audio id="rain" loop preload="none" src="https://cdn.pixabay.com/download/audio/2021/09/07/audio_2792e7a5a0.mp3?filename=rain-ambient-108802.mp3"></audio>
        <audio id="forest" loop preload="none" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_620e7b4e8b.mp3?filename=forest-ambience-120189.mp3"></audio>
      </div>
    </section>

    <!-- Mantras -->
    <section class="step-section" data-step="4">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="mantras">ğŸ§  Mantras to Remember (tap to change)</h2>
      <div id="mantras" class="collapsible-content" aria-hidden="true">
        <div class="mantra-box">
          <div id="mantraText" class="mantra-text" role="button" tabindex="0" aria-pressed="false">I am safe and this will pass.</div>
          <button id="nextMantra" class="mantra-next">Next Mantra</button>
        </div>
      </div>
    </section>

    <!-- Check-In -->
    <section class="step-section" data-step="5">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="checkin">ğŸ§ Check-In With Yourself</h2>
      <div id="checkin" class="collapsible-content" aria-hidden="true">
        <ul>
          <li>Am I hydrated? Slowly sip water.</li>
          <li>Can I talk to a trusted friend or sitter? Call or text them.</li>
          <li>Can I sit or lie down safely? Slow deep breaths help.</li>
          <li>Are my clothes comfortable? Remove tight layers if needed.</li>
        </ul>
      </div>
    </section>

    <!-- Wait / Calm Timer -->
    <section class="step-section" data-step="6">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="wait">â³ Just Wait â€” Calm Timer</h2>
      <div id="wait" class="collapsible-content" aria-hidden="true">
        <p style="text-align:center">Settle in. Panic often drops after 10â€“20 minutes. Use the timer below.</p>
        <div id="timerDisplay" class="timer-display" aria-live="polite">15:00</div>
        <div class="timer-controls">
          <button id="startTimer" class="timer-btn">Start</button>
          <button id="pauseTimer" class="timer-btn">Pause</button>
          <button id="resetTimer" class="timer-btn">Reset</button>
        </div>
      </div>
    </section>

    <!-- Tripping at Shows -->
    <section class="step-section" data-step="7">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="shows">ğŸµ Tripping at Shows â€” Stay Safe</h2>
      <div id="shows" class="collapsible-content" aria-hidden="true">
        <ul>
          <li><strong>Hydrate:</strong> sip water slowly and often. Avoid chugging or sugary drinks.</li>
          <li><strong>Eat:</strong> light carbs or fruit help; avoid heavy greasy foods if you're nauseous.</li>
          <li><strong>Environment:</strong> step outside or to a chill zone if overwhelmed â€” quiet spaces help a lot.</li>
          <li><strong>Buddy system:</strong> stay with someone you trust; check in every 10 minutes.</li>
          <li><strong>Avoid:</strong> mixing substances or lots of alcohol; don't push your body (dance breaks are fine).</li>
          <li><strong>Tools:</strong> sunglasses, earplugs, a small bottle of water, and breathing exercises.</li>
        </ul>
      </div>
    </section>

    <!-- Emergency / Resources -->
    <section class="step-section" data-step="8">
      <h2 tabindex="0" role="button" aria-expanded="false" aria-controls="backup">ğŸ“ Need Backup?</h2>
      <div id="backup" class="collapsible-content" aria-hidden="true">
        <p style="text-align:center">If you need human support right now, these resources are available:</p>
        <a class="resource-btn" href="https://tripsit.me/" target="_blank" rel="noopener">TripSit â€” Live Chat & Resources</a>
        <a class="resource-btn" href="https://firesideproject.org/" target="_blank" rel="noopener">Fireside Project â€” Support Line</a>
        <a class="resource-btn" href="https://neverusealone.com/" target="_blank" rel="noopener">Never Use Alone â€” Phone Check</a>
        <a class="resource-btn" href="/panic.html">ğŸš¨ Panic Button (your site)</a>
        <a class="resource-btn" href="/emergency.html">ğŸš‘ Emergency Help (your site)</a>
        <a class="resource-btn" href="index.html">ğŸ  I'm Feeling Better â€” Back Home</a>
      </div>
    </section>

    <p id="encouragement" class="encouragement" role="status" aria-live="polite"></p>

    <footer>
      <small>PLURderapolis â€¢ Your partners in shine ğŸ‘</small>
    </footer>
  </main>

<script>
/* --- Helper & State --- */
const sections = Array.from(document.querySelectorAll('.step-section'));
const progressBar = document.getElementById('progressBar');
const encouragement = document.getElementById('encouragement');
let mantraIndex = 0;
const mantras = [
  "I am safe and this will pass.",
  "This feeling is temporary â€” I can wait.",
  "I can breathe. I can slow down.",
  "I have survived this before. I will again.",
  "Small steps. One breath at a time."
];

/* --- Collapsible logic (headers open/close) --- */
document.querySelectorAll('section h2').forEach(header => {
  header.addEventListener('click', () => {
    const id = header.getAttribute('aria-controls');
    const content = document.getElementById(id);
    if (!content) return;
    const opened = content.classList.toggle('open');
    header.setAttribute('aria-expanded', opened);
    content.setAttribute('aria-hidden', !opened);
    updateProgress();
    maybeEncourage();
  });
  header.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' || e.key === ' ') header.click();
  });
});

/* --- Sensory Safe Mode --- */
const safeBtn = document.getElementById('toggleSafe');
safeBtn.addEventListener('click', () => {
  const on = document.body.classList.toggle('safe-mode');
  safeBtn.setAttribute('aria-pressed', on);
  // stop all audio on safe mode on
  if (on) stopAllAudio();
});

/* --- Guided / Modular Modes --- */
document.getElementById('guidedMode').addEventListener('click', () => {
  // close all first
  document.querySelectorAll('.collapsible-content').forEach(c => { c.classList.remove('open'); c.setAttribute('aria-hidden','true'); });
  document.querySelectorAll('section h2').forEach(h=>h.setAttribute('aria-expanded','false'));
  let i = 0;
  function openStep() {
    if (i >= sections.length) return;
    const sec = sections[i];
    const content = sec.querySelector('.collapsible-content');
    content.classList.add('open');
    content.setAttribute('aria-hidden','false');
    sec.querySelector('h2').setAttribute('aria-expanded','true');
    updateProgress();
    maybeEncourage();
    i++;
    setTimeout(openStep, 900); // short pause between steps
  }
  openStep();
});

document.getElementById('modularMode').addEventListener('click', () => {
  document.querySelectorAll('.collapsible-content').forEach(c => { c.classList.remove('open'); c.setAttribute('aria-hidden','true'); });
  document.querySelectorAll('section h2').forEach(h=>h.setAttribute('aria-expanded','false'));
  updateProgress();
});

/* --- Progress bar --- */
function updateProgress() {
  const total = sections.length;
  const openCount = sections.filter(s => s.querySelector('.collapsible-content').classList.contains('open')).length;
  const pct = Math.round((openCount / total) * 100);
  progressBar.style.width = pct + '%';
}

/* --- Encouragement messages --- */
function maybeEncourage() {
  encouragement.style.display = 'block';
  const msgs = [
    "ğŸŒŸ Keep going â€” you're doing great.",
    "âœ… Small steps. You're safe.",
    "ğŸ’› Breathe. You got this.",
    "âœ¨ Nice work â€” keep using the tools."
  ];
  encouragement.textContent = msgs[Math.floor(Math.random() * msgs.length)];
  setTimeout(()=> encouragement.style.display = 'none', 3200);
}

/* --- Breathing visuals selection --- */
const breathBtns = document.querySelectorAll('.breath-btn');
const breathShape = document.getElementById('breathShape');
breathBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const shape = btn.getAttribute('data-shape');
    // remove other classes then set the chosen one
    breathShape.className = shape;
    // update aria-checked for buttons
    breathBtns.forEach(b => b.setAttribute('aria-checked', 'false'));
    btn.setAttribute('aria-checked', 'true');
  });
});

/* --- Grounding buttons (interactive) --- */
const groundButtons = document.querySelectorAll('.ground-btn');
const groundingCompleteEl = document.getElementById('groundingComplete');
let groundedCount = 0;
groundButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    if (btn.classList.contains('done')) return;
    btn.classList.add('done');
    groundedCount++;
    // show textual cue
    maybeEncourage();
    if (groundedCount >= groundButtons.length) {
      groundingCompleteEl.style.display = 'block';
      groundingCompleteEl.setAttribute('aria-hidden', 'false');
    }
  });
});

/* --- Audio controls (one plays at a time) --- */
let currentAudio = null;
const audioButtons = document.querySelectorAll('.audio-btn');
audioButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.dataset.sound;
    if (id === 'stopAll') { stopAllAudio(); return; }
    const audio = document.getElementById(id);
    if (!audio) return;
    // stop other audio
    if (currentAudio && currentAudio !== audio) { currentAudio.pause(); currentAudio.currentTime = 0; updateAudioButtons(); currentAudio = null; }
    if (audio.paused) {
      audio.play().catch(()=>{}); // ignore play promise problems
      currentAudio = audio;
      btn.classList.add('playing');
    } else {
      audio.pause();
      audio.currentTime = 0;
      btn.classList.remove('playing');
      currentAudio = null;
    }
  });
});

function stopAllAudio() {
  document.querySelectorAll('audio').forEach(a => { try{ a.pause(); a.currentTime = 0 } catch(e){} });
  updateAudioButtons();
  currentAudio = null;
}

function updateAudioButtons() {
  audioButtons.forEach(b => {
    const id = b.dataset.sound;
    if (!id) return;
    const a = document.getElementById(id);
    if (a && !a.paused) b.classList.add('playing'); else b.classList.remove('playing');
  });
}

/* Ensure audio stops if safe mode toggled on */
const safeCheckbox = document.getElementById('toggleSafe');
safeCheckbox.addEventListener('click', () => {
  if (document.body.classList.contains('safe-mode')) {
    stopAllAudio();
  }
});

/* --- Mantra: tap to change & Next button --- */
const mantraText = document.getElementById('mantraText');
const nextMantra = document.getElementById('nextMantra');

function showNextMantra() {
  mantraIndex = (mantraIndex + 1) % mantras.length;
  mantraText.textContent = mantras[mantraIndex];
}
nextMantra.addEventListener('click', showNextMantra);
mantraText.addEventListener('click', showNextMantra);
mantraText.addEventListener('keypress', (e) => { if (e.key === 'Enter' || e.key === ' ') showNextMantra(); });

/* --- Timer logic (15 minutes default) --- */
let timer = null;
let timeLeft = 900; // seconds
const timerDisplay = document.getElementById('timerDisplay');
const startBtn = document.getElementById('startTimer');
const pauseBtn = document.getElementById('pauseTimer');
const resetBtn = document.getElementById('resetTimer');

function updateTimerDisplay() {
  const m = String(Math.floor(timeLeft / 60)).padStart(2, '0');
  const s = String(timeLeft % 60).padStart(2, '0');
  timerDisplay.textContent = `${m}:${s}`;
}

startBtn.addEventListener('click', () => {
  if (timer) return; // already running
  timer = setInterval(() => {
    if (timeLeft <= 0) { clearInterval(timer); timer = null; maybeEncourage(); return; }
    timeLeft--;
    updateTimerDisplay();
  }, 1000);
});

pauseBtn.addEventListener('click', () => {
  if (timer) { clearInterval(timer); timer = null; }
});
resetBtn.addEventListener('click', () => { clearInterval(timer); timer = null; timeLeft = 900; updateTimerDisplay(); });

updateTimerDisplay();

/* --- Keyboard accessibility: allow space/enter on section headers already handled earlier via keypress listener --- */

/* --- Initialize: set default breathing shape class name properly --- */
(function init(){
  // default to circle
  breathShape.className = 'breathing-shape';
  // ensure audio button aria and update
  updateAudioButtons();
  updateProgress();
})();
</script>
</body>
</html>
