<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Polydrug Risks & Interaction Checker | PLURderapolis</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#121212;
    --card:#1b0b1b;
    --ink:#eee;
    --muted:#bcbcbc;
    --accent:#bf00bf;
    --accent-2:#e051ff;
    --line:#440044;
    --chip:#550055;
    --shadow:0 0 12px rgba(191,0,191,.25);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:'Open Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{color:var(--accent)}
  .wrap{max-width:1000px;margin:auto;padding:16px}
  h1,h2,h3{font-family:'Montserrat',sans-serif;letter-spacing:.2px}
  h1{font-size:clamp(1.6rem,2.5vw,2.2rem);color:var(--accent);margin:8px 0 6px}
  p.lede{color:#f0d1ff;margin:.25rem 0 1rem}
  /* Top checker card */
  .tool{background:var(--card);border-radius:14px;padding:14px;box-shadow:var(--shadow);position:sticky;top:0.35rem;z-index:5}
  .tool h2{font-size:1.1rem;margin:.2rem 0 .6rem;color:var(--accent-2)}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .sel{flex:1 1 180px;min-width:160px;display:flex;flex-direction:column;gap:6px}
  label{font-weight:700;color:var(--accent);font-size:.9rem}
  select{width:100%;padding:.6rem .7rem;border:1px solid var(--line);border-radius:10px;background:#220022;color:var(--ink);appearance:none}
  button.primary{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:.7rem 1rem;font-weight:800;cursor:pointer}
  button.primary:active{transform:translateY(1px)}
  .icons{font-size:1.05rem;opacity:.95}
  .result{margin-top:10px;border:1px dashed var(--line);border-radius:12px;padding:10px;background:#170717}
  .result h3{margin:.2rem 0 .4rem;color:#ffd6ff;font-size:1rem}
  .pairs{margin:.4rem 0 0;padding-left:18px}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 0;font-size:.95rem;color:var(--muted)}
  .legend span{display:inline-flex;gap:6px;align-items:center;background:#200120;border:1px solid var(--line);border-radius:999px;padding:.25rem .6rem}
  /* Matrix */
  .controls{display:flex;align-items:center;gap:10px;margin:14px 0 8px}
  .download{background:var(--accent);color:#fff;border:0;border-radius:999px;padding:.55rem .9rem;font-weight:800;cursor:pointer}
  .share{background:#2a002a;color:#fff;border:1px solid var(--line);border-radius:999px;padding:.55rem .9rem;font-weight:700;cursor:pointer}
  .matrix{overflow:auto;border-radius:12px;box-shadow:var(--shadow);border:1px solid var(--line);background:#160616}
  table{border-collapse:collapse;width:100%;min-width:980px;font-size:.92rem}
  th,td{border:1px solid var(--line);padding:.45rem .55rem;text-align:center;vertical-align:middle}
  thead th{position:sticky;top:0;background:#3b0a3b;color:#ffe5ff;z-index:2}
  tbody th{position:sticky;left:0;background:#2a002a;color:#fff;z-index:1}
  td{background:#1f001f}
  .chip {display:inline-block;background:var(--chip);border-radius:999px;padding:.18rem .55rem;font-weight:700}
  /* Sections at bottom (accordion) */
  details.info{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:.6rem .8rem;margin:.6rem 0}
  details.info summary{cursor:pointer;font-weight:800;list-style:none}
  details.info summary::marker, details.info summary::-webkit-details-marker{display:none}
  details.info summary .tag{margin-left:.5rem;opacity:.85}
  /* Footer */
  footer{border-top:1px solid var(--line);color:var(--muted);font-size:.9rem;padding:18px;margin-top:16px;text-align:center}
  .pill{display:inline-block;background:var(--chip);padding:.22rem .6rem;border-radius:999px;font-weight:800}
  /* Mobile niceties */
  @media (max-width:640px){
    .tool{position:static}
    .legend{font-size:.9rem}
    table{font-size:.86rem;min-width:840px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Polydrug Interaction Checker <span class="icons">⚡💊💀🌈</span></h1>
    <p class="lede">Mobile-first, harm-reduction focused. Pick up to three substances and see risks & tips. Matrix is downloadable + shareable.</p>

    <!-- ===== Interaction Checker (TOP) ===== -->
    <section class="tool" aria-label="Polydrug Interaction Checker">
      <h2>Quick Check</h2>
      <div class="row">
        <div class="sel">
          <label for="drugA">Substance A</label>
          <select id="drugA"></select>
        </div>
        <div class="sel">
          <label for="drugB">Substance B</label>
          <select id="drugB"></select>
        </div>
        <div class="sel">
          <label for="drugC">Substance C (optional)</label>
          <select id="drugC"></select>
        </div>
        <div class="sel" style="align-self:flex-end">
          <button class="primary" id="checkBtn">Check <span class="icons">⚡</span></button>
        </div>
      </div>

      <div class="legend" aria-label="Legend">
        <span><b>🌈</b> Low concern / typical</span>
        <span><b>⚡</b> Caution</span>
        <span><b>💊</b> Strong caution / interaction risk</span>
        <span><b>💀</b> Dangerous / avoid</span>
      </div>

      <div class="result" id="resultBox" aria-live="polite">
        <h3>Results will appear here</h3>
        <p>We’ll show A+B, A+C, B+C and a combined A+B+C overview with quick harm-reduction pointers.</p>
      </div>
    </section>

    <!-- ===== Controls + Matrix ===== -->
    <div class="controls">
      <button class="download" id="dlCsv">Download Matrix (CSV)</button>
      <button class="share" id="shareBtn">Share Page</button>
      <span class="muted" style="color:var(--muted)">Tip: drag left/right to explore the grid on mobile.</span>
    </div>

    <div class="matrix" role="region" aria-label="Combo Risk Matrix">
      <table id="matrix"></table>
    </div>

    <!-- ===== Tips (quick) ===== -->
    <details class="info" open>
      <summary>💡 Harm Reduction Tips <span class="tag">(quick)</span></summary>
      <ul>
        <li>Test what you can. Start low, go slow. Space redoses.</li>
        <li><span class="pill">Never stack depressants</span> (alcohol, benzos, GHB, opioids) — biggest driver of fatal ODs.</li>
        <li>Heat + stimulants = risk. Cool environment, electrolyte sips, rest breaks.</li>
        <li>Carry naloxone if opioids could be around. Don’t use alone. Recovery position if someone is out.</li>
        <li>On Rx meds? Avoid chasing “muted” effects by redosing — risk goes up even if euphoria doesn’t.</li>
      </ul>
    </details>

    <!-- ===== Category cards at bottom ===== -->
    <h2 style="margin-top:14px;color:var(--accent-2)">Combo Categories</h2>

    <details class="info"><summary>💊 Depressant × Depressant <span class="tag">benzodiazepines, alcohol, GHB, opioids, trazodone, gabapentin</span></summary>
      <p><b>Risk:</b> <b>💀</b> — synergistic respiratory depression, blackouts, aspiration.</p>
      <ul>
        <li>Keep people awake & breathing; recovery position if unresponsive.</li>
        <li>Naloxone reverses opioids (not benzos/GHB); still call EMS.</li>
      </ul>
    </details>

    <details class="info"><summary>⚡ Stimulant × Stimulant <span class="tag">MDMA, cocaine, ADHD meds, bupropion</span></summary>
      <p><b>Risk:</b> <b>💊→💀</b> — hypertension, hyperthermia, arrhythmia, panic.</p>
      <ul>
        <li>Avoid stacking; cool down, hydrate, don’t chase muted highs.</li>
      </ul>
    </details>

    <details class="info"><summary>⚡ Stimulant × Depressant <span class="tag">e.g., cocaine+alcohol, MDMA+GHB</span></summary>
      <p><b>Risk:</b> <b>💊</b> — masking sedation, dehydration, liver stress (cocaethylene with alcohol+cocaine).</p>
      <ul>
        <li>Don’t redose to “even it out”. Watch breathing and heat load.</li>
      </ul>
    </details>

    <details class="info"><summary>🌈/⚡ Psychedelics with Cannabis</summary>
      <p>Can potentiate intensity/anxiety. Delay THC until past peak; micro-puffs if at all.</p>
    </details>

    <details class="info"><summary>⚡ Dissociative × Depressant <span class="tag">ketamine/nitrous + alcohol/benzos/GHB</span></summary>
      <p>Hypoxia/airway risk + amnesia. Sit down, supervised, fresh air breaks.</p>
    </details>

    <!-- ===== Legal disclaimer (single) ===== -->
    <footer>
      <p><strong>Legal & Medical Disclaimer:</strong> Educational content only; not medical advice. No mix is 100% safe. Accuracy is prioritized using established harm-reduction resources (TripSit, DanceSafe, IMPACT SF, TheBody) plus your local notes, but contexts differ. If someone shows trouble breathing, severe chest pain, seizures, or won’t wake, call emergency services.</p>
      <p>© 2025 PLURderapolis • <span class="pill">Stay safe. Stay kind.</span></p>
    </footer>
  </div>

<script>
/* ============================================================
   DATA INGEST: Your original 20-substance matrix (as posted)
   Symbols: —, 🟢, 🟡, 🔴, ⚠️, ❌, ☠️
   We will translate to minimalist icons later.
============================================================ */
const originalHeaders = ["Cannabis","Ketamine","MDMA","Cocaine","Alcohol","GHB / Opioids","Benzos","SSRIs","SNRIs","ADHD Meds","Antipsychotics","Mood Stabilizers","Wellbutrin","Trazodone","Gabapentin","LSD","Shrooms","Nitrous","DMT","GHB"];
// NOTE: Your pasted table had 20 columns; the last header label you included row-wise was “GHB” again.
// We’re trusting the body rows you posted below (they match 20-wide). The body:
const originalRows = [
  ["Cannabis","—","🟡","🔴","🔴","🔴","🔴","🔴","🟡","🟡","🟢","🟡","🟡","🟢","🟢","🟢","🔴","🔴","🟢","🔴","🔴"],
  ["Ketamine","🟡","—","❌","❌","❌","❌","🟡","🟡","🟡","🔴","🟡","🟡","🟡","🟡","🟡","❌","❌","🟡","❌","❌"],
  ["MDMA","🔴","❌","—","🔴","🔴","❌","🔴","🔴","❌","❌","❌","❌","❌","🔴","🔴","🔴","🔴","🔴","❌","❌"],
  ["Cocaine","🔴","❌","🔴","—","🔴","❌","🔴","🔴","❌","❌","🔴","🔴","🔴","🔴","🔴","🔴","🔴","🔴","❌","❌"],
  ["Alcohol","🔴","❌","🔴","🔴","—","❌","☠️","⚠️","⚠️","⚠️","⚠️","⚠️","❌","❌","❌","🔴","🔴","❌","❌","☠️"],
  ["GHB / Opioids","🔴","❌","❌","❌","☠️","—","☠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","❌","❌","⚠️","☠️","—"],
  ["Benzos","🔴","🟡","🔴","🔴","☠️","☠️","—","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","☠️","⚠️"],
  ["SSRIs","🟡","🟡","🔴","🔴","⚠️","⚠️","⚠️","—","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["SNRIs","🟡","🟡","❌","❌","⚠️","⚠️","⚠️","⚠️","—","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["ADHD Meds","🟢","🟡","❌","❌","⚠️","⚠️","⚠️","⚠️","⚠️","—","🟡","🟡","🟡","🟡","🟡","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["Antipsychotics","🟡","🟡","❌","🔴","⚠️","⚠️","⚠️","⚠️","⚠️","🟡","—","🟡","🟡","🟡","🟡","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["Mood Stabilizers","🟡","🟡","❌","🔴","⚠️","⚠️","⚠️","⚠️","⚠️","🟡","🟡","—","🟡","🟡","🟡","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["Wellbutrin","🟢","🟡","❌","🔴","❌","⚠️","⚠️","⚠️","⚠️","🟡","🟡","🟡","—","🟡","🟡","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["Trazodone","🟢","🟡","🔴","🔴","❌","⚠️","⚠️","⚠️","⚠️","🟡","🟡","🟡","🟡","—","🟢","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["Gabapentin","🟢","🟡","🔴","🔴","❌","⚠️","⚠️","⚠️","⚠️","🟡","🟡","🟡","🟡","🟢","—","⚠️","⚠️","⚠️","⚠️","⚠️"],
  ["LSD","🔴","🟡","🔴","🔴","🔴","❌","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","—","🟢","🟡","🟡","🔴"],
  ["Shrooms","🔴","❌","🔴","🔴","🔴","❌","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","🟢","⚠️","🟢","—","🟡","🟡","🔴"],
  ["Nitrous","🟢","🟡","🔴","🔴","❌","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","🟡","🟡","—","⚠️","⚠️"],
  ["DMT","🔴","❌","❌","❌","❌","☠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","🔴","🔴","⚠️","—","☠️"],
  ["GHB","🔴","❌","❌","☠️","☠️","—","☠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","⚠️","🔴","🔴","⚠️","☠️","—"]
];

/* ============================================================
   TRANSLATION to minimalist icons
   —, 🟢 -> 🌈   |   🟡 -> ⚡   |   🔴/⚠️ -> 💊   |   ❌/☠️ -> 💀
============================================================ */
const toMini = s => {
  if (s==="—" || s==="🟢") return "🌈";
  if (s==="🟡") return "⚡";
  if (s==="🔴" || s==="⚠️") return "💊";
  if (s==="❌" || s==="☠️") return "💀";
  return s || "🌈";
};

/* ============================================================
   Expand “GHB / Opioids” -> split into “GHB” + “Opioids”
   Then add “Viagra”. Non-specified Viagra cells are conservative.
============================================================ */
function buildExpandedMatrix(){
  // Build base map from original
  const baseCols = originalHeaders;
  const baseMap = new Map(); // key "row|col" -> minimalist icon
  for (const r of originalRows){
    const rowName = r[0];
    const cols = r.slice(1);
    cols.forEach((val,i)=>{
      const colName = baseCols[i];
      baseMap.set(`${rowName}|${colName}`, toMini(val));
    });
  }

  // Start list from original headers, but replace combined class with two
  const expanded = [
    "Cannabis","Ketamine","MDMA","Cocaine","Alcohol",
    "GHB","Opioids", // split
    "Benzos","SSRIs","SNRIs","ADHD Meds","Antipsychotics","Mood Stabilizers",
    "Wellbutrin","Trazodone","Gabapentin","LSD","Shrooms","Nitrous","DMT"
  ];

  // Helper to read combined mapping for either GHB or Opioids from "GHB / Opioids"
  const readCombined = (row, col) => {
    const key1 = `${row}|GHB / Opioids`;
    const key2 = `GHB / Opioids|${col}`;
    // prefer direct if exists
    if (baseMap.has(key1) && col==="GHB / Opioids") return baseMap.get(key1);
    if (baseMap.has(`${row}|${col}`)) return baseMap.get(`${row}|${col}`);
    if (baseMap.has(key1)) return baseMap.get(key1);
    if (baseMap.has(key2)) return baseMap.get(key2);
    return "⚡";
  };

  // Build expanded map (without Viagra yet)
  const m = new Map();

  // Copy all non-combined pairs first
  for (const r of expanded){
    for (const c of expanded){
      if (r===c){ m.set(`${r}|${c}`,"🌈"); continue; }
      // If either is GHB or Opioids, pull from combined where needed
      if ((r==="GHB" || r==="Opioids") && (c!=="GHB" && c!=="Opioids")){
        m.set(`${r}|${c}`, readCombined("GHB / Opioids", c));
        m.set(`${c}|${r}`, readCombined(c, "GHB / Opioids"));
      } else if ((c==="GHB" || c==="Opioids") && (r!=="GHB" && r!=="Opioids")){
        m.set(`${r}|${c}`, readCombined(r, "GHB / Opioids"));
        m.set(`${c}|${r}`, readCombined("GHB / Opioids", r));
      } else if ( (r!=="GHB" && r!=="Opioids") && (c!=="GHB" && c!=="Opioids") ){
        // both sides not split items: read from base
        const val = baseMap.get(`${r}|${c}`) ?? baseMap.get(`${c}|${r}`) ?? "⚡";
        m.set(`${r}|${c}`, val);
      }
    }
  }
  // Set explicit GHB <-> Opioids as 💀
  m.set("GHB|Opioids","💀"); m.set("Opioids|GHB","💀");

  // Now add Viagra row/col conservatively
  const withViagra = [...expanded, "Viagra"];
  for (const x of withViagra){
    if (x==="Viagra") continue;
  }
  // Defaults for Viagra
  const vDefaults = {
    "Cannabis":"🌈",
    "Ketamine":"⚡",
    "MDMA":"💊",
    "Cocaine":"💊",
    "Alcohol":"💊",
    "GHB":"💊",
    "Opioids":"💊",
    "Benzos":"⚡",
    "SSRIs":"🌈",
    "SNRIs":"⚡",
    "ADHD Meds":"💊",
    "Antipsychotics":"⚡",
    "Mood Stabilizers":"⚡",
    "Wellbutrin":"⚡",
    "Trazodone":"💊",
    "Gabapentin":"💊",
    "LSD":"⚡",
    "Shrooms":"⚡",
    "Nitrous":"🌈", // N2O ≠ nitrites
    "DMT":"⚡"
  };
  for (const s of expanded){
    const val = vDefaults[s] ?? "⚡";
    m.set(`Viagra|${s}`, val);
    m.set(`${s}|Viagra`, val);
  }
  m.set("Viagra|Viagra","🌈");

  return {headers: withViagra, map:m};
}

const {headers, map:mini} = buildExpandedMatrix();

/* ============================================================
   UI: Populate selects, render matrix, CSV download, share
============================================================ */
const allSubs = headers.slice(); // 21 including Viagra

function fillSelect(id){
  const sel = document.getElementById(id);
  sel.innerHTML = '<option value="">— Select —</option>' + allSubs.map(s=>`<option>${s}</option>`).join('');
}
["drugA","drugB","drugC"].forEach(fillSelect);

function iconExplain(x){
  switch(x){
    case "🌈": return "Low concern / typical co-use profile reported";
    case "⚡": return "Caution — increased side-effect potential; go slow";
    case "💊": return "Strong caution — meaningful interaction risk";
    case "💀": return "Danger — avoid / high overdose or medical risk";
    default: return "—";
  }
}

function renderPairs(sel){
  // Unique pairs + worst icon
  const pairs = [];
  const rank = {"🌈":1,"⚡":2,"💊":3,"💀":4};
  let worst = "🌈";
  for (let i=0;i<sel.length;i++){
    for (let j=i+1;j<sel.length;j++){
      const a = sel[i], b = sel[j];
      const v = mini.get(`${a}|${b}`) ?? mini.get(`${b}|${a}`) ?? "⚡";
      pairs.push({a,b,v});
      if (rank[v] > rank[worst]) worst = v;
    }
  }
  return {pairs,worst};
}

function tripleAdvisory(sel, worst){
  if (sel.length<3) return "";
  const [a,b,c]=sel;
  // Simple combined note anchored to worst symbol
  const msg = {
    "🌈":"No notable red flags reported for this trio; still pace yourself and hydrate.",
    "⚡":"Caution: overlapping effects. Keep doses low, add time between, and monitor heat/heart.",
    "💊":"Strong caution: interactions likely stack. Avoid redosing to overcome muted effects. Have a sober buddy.",
    "💀":"Danger: this trio includes a high-risk pair (e.g., depressant stacking or stimulant+depressant with opioids). Avoid."
  }[worst];
  return `<p><b>All three:</b> ${a} + ${b} + ${c} → <b>${worst}</b> — ${msg}</p>`;
}

document.getElementById("checkBtn").addEventListener("click", ()=>{
  const sel = ["drugA","drugB","drugC"].map(id=>document.getElementById(id).value).filter(Boolean);
  const box = document.getElementById("resultBox");
  if (sel.length<2){
    box.innerHTML = `<h3>Please select at least two substances.</h3>`;
    return;
  }
  const {pairs,worst} = renderPairs(sel);
  const items = pairs.map(p=>`<li><b>${p.a}</b> + <b>${p.b}</b> → <span class="chip">${p.v}</span> <span style="color:var(--muted)">(${iconExplain(p.v)})</span></li>`).join('');
  box.innerHTML = `
    <h3>Results</h3>
    <ul class="pairs">${items}</ul>
    ${tripleAdvisory(sel, worst)}
    <p style="margin-top:.5rem;color:var(--muted)">Icons: 🌈 low • ⚡ caution • 💊 strong caution • 💀 danger. Use the matrix below for more context.</p>
  `;
});

// Render matrix table
(function renderMatrix(){
  const tbl = document.getElementById("matrix");
  const thead = document.createElement("thead");
  const hrow = document.createElement("tr");
  hrow.appendChild(document.createElement("th")).textContent = "↓ / →";
  headers.forEach(h=>{ const th=document.createElement("th"); th.textContent=h; hrow.appendChild(th); });
  thead.appendChild(hrow);
  const tbody = document.createElement("tbody");
  headers.forEach(r=>{
    const tr = document.createElement("tr");
    const rowTh = document.createElement("th"); rowTh.textContent=r; tr.appendChild(rowTh);
    headers.forEach(c=>{
      const td = document.createElement("td");
      td.setAttribute("data-label", c);
      const val = mini.get(`${r}|${c}`) ?? mini.get(`${c}|${r}`) ?? "🌈";
      td.textContent = val;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  tbl.appendChild(thead); tbl.appendChild(tbody);
})();

// CSV download (minimalist icons)
document.getElementById("dlCsv").addEventListener("click", ()=>{
  let csv = "Substance," + headers.join(",") + "\n";
  headers.forEach(r=>{
    let line = [r];
    headers.forEach(c=>{
      const val = mini.get(`${r}|${c}`) ?? mini.get(`${c}|${r}`) ?? "🌈";
      line.push(val);
    });
    csv += line.join(",") + "\n";
  });
  const blob = new Blob([csv],{type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "plur-polydrug-matrix.csv";
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

// Share button (Web Share API)
document.getElementById("shareBtn").addEventListener("click", async ()=>{
  try{
    if (navigator.share){
      await navigator.share({title:"PLURderapolis Polydrug Matrix", text:"Check interactions + harm reduction tips", url:location.href});
    } else {
      alert("Copy this page URL to share:\n"+location.href);
    }
  }catch(e){ /* user cancelled */ }
});
</script>
</body>
</html>
